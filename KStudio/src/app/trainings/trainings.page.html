<ion-content #popup class="popup-modal-trainings">
  <div class="drag-handle"></div>
  
  <div class="content-container">
    <div class="sticky-header">
      <!-- Header Tabs for "All" and "Favorites" -->
      <div class="header-tabs">
        <ion-segment mode="md" [(ngModel)]="selectedFilter" class="segment-tab">
          <ion-segment-button value="all" class="custom-tabs">
            <ion-label>הכל</ion-label>
          </ion-segment-button>
          <ion-segment-button value="favorites" class="custom-tabs">
            <ion-label>מועדפים</ion-label>
          </ion-segment-button>
        </ion-segment>
      </div>

    <!-- Scrolling Tabs for Days -->
    <ion-segment scrollable mode="md" [(ngModel)]="selectedDay" class="days-tabs">
      <ion-segment-button *ngFor="let day of days" value="{{ day.date }}" class="custom-tabs">
        <ion-label>{{ day.day }}</ion-label>
        <ion-note>{{ day.date }}</ion-note>
      </ion-segment-button>
    </ion-segment>

      <!-- Single Filter Button with clear "X" button -->
      <div class="filter-header">
        <ion-icon name="filter-circle-outline" class="filter-icon" (click)="toggleDropdown()" size="large"></ion-icon>
        <ion-icon name="close-circle-outline" class="clear-filter-icon" *ngIf="selectedType" (click)="clearTypeFilter()"></ion-icon>
      </div>

      <!-- Modern Dropdown for Filters -->
      <ion-list *ngIf="showDropdown" class="filter-dropdown">
        <ion-item>
          <ion-label>סוג אימון</ion-label>
          <ion-select [(ngModel)]="selectedType" interface="popover" placeholder="בחר סוג אימון">
            <ion-select-option *ngFor="let type of availableTypes" [value]="type">{{ type }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label>זמינות</ion-label>
          <ion-segment [(ngModel)]="availabilityFilter">
            <ion-segment-button value="all">
              <ion-label>הכל</ion-label>
            </ion-segment-button>
            <ion-segment-button value="available">
              <ion-label>זמין בלבד</ion-label>
            </ion-segment-button>
          </ion-segment>
        </ion-item>
      </ion-list>
    </div>
    
    <!-- List of Trainings for Selected Day -->
    <div class="scrollable-list">
      <ion-list>
        <ion-item *ngFor="let item of getAppointmentsForSelectedDay()" lines="none">
          <ion-card class="training-card">
            <ion-card-header>
              <div class="training-header">
                <ion-label>
                  <h2 *ngIf="item.type === 'appointment'">{{ item.service.name }}</h2>
                  <h2 *ngIf="item.type === 'timeslot'">Available Timeslot</h2>
                  <p>{{ item.start_time | date: 'shortTime' }} - {{ item.end_time | date: 'shortTime' }}</p>
                </ion-label>
              </div>
            </ion-card-header>

            <ion-card-content *ngIf="item.type === 'appointment'">
              <div class="progress-container">
                <ion-icon name="people-outline" color="medium" size="large"></ion-icon>
                <ion-label>
                  {{ item.booked }}/{{ item.capacity }}
                </ion-label>
                <ion-progress-bar value="{{ item.booked / item.capacity }}"></ion-progress-bar>
              </div>
            </ion-card-content>

            <ion-card-content *ngIf="item.type === 'timeslot'">
              <ion-label>
                Available Slot - Book Now!
              </ion-label>
            </ion-card-content>
          </ion-card>
        </ion-item>
      </ion-list>
    </div>
  </div>
</ion-content>
