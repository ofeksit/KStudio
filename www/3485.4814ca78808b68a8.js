"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3485],{3485:(x,m,r)=>{r.r(m),r.d(m,{LoginPageModule:()=>I});var f=r(177),c=r(9417),u=r(791),d=r(685),v=r(467),p=r(1626),l=r(5558),D=r(8141),P=r(9437),h=r(7673),w=r(8810),b=r(5806),t=r(3953),M=r(4796);function k(e,a){1&e&&t.nrm(0,"ion-spinner",17)}function E(e,a){1&e&&(t.j41(0,"span"),t.EFF(1,"\u05d4\u05ea\u05d7\u05d1\u05e8"),t.k0s())}function C(e,a){1&e&&t.nrm(0,"ion-progress-bar",18)}const y=[{path:"",component:(()=>{var e;class a{constructor(i,o,n,s){this.authService=i,this.router=o,this.http=n,this.toastController=s,this.username="",this.password="",this.errorMessage="",this.showToast=!1,this.toastMessage="",this.toastColor="success",this.showProgressBar=!1,this.isLoading=!1,this.passwordType="password",this.passwordIcon="eye-off",b.s3.addListener("keyboardWillShow",()=>{console.log("Keyboard is opening"),document.body.classList.add("keyboard-open")}),b.s3.addListener("keyboardWillHide",()=>{console.log("Keyboard is closing"),document.body.classList.remove("keyboard-open")})}presentToast(i,o){var n=this;return(0,v.A)(function*(){yield(yield n.toastController.create({message:i,duration:3e3,color:o,position:"top"})).present()})()}login(){var i=this;if(!this.username||!this.password)return this.errorMessage="\u05d0\u05e0\u05d0 \u05de\u05dc\u05d0 \u05d0\u05ea \u05e9\u05dd \u05d4\u05de\u05e9\u05ea\u05de\u05e9 \u05d5\u05d4\u05e1\u05d9\u05e1\u05de\u05d4",void this.presentToast(this.errorMessage,"danger");this.isLoading=!0,this.authService.login(this.username,this.password).pipe((0,l.n)(o=>{this.authService.storeToken(o.data.token),this.authService.storeUserID(o.data.id),this.authService.storeUserEmail(o.data.email);const n=new p.Lr({Authorization:`Bearer ${o.data.token}`});return this.http.get("https://k-studio.co.il/wp-json/wp/v2/users/me",{headers:n})}),(0,l.n)(o=>{this.authService.storeUserFullName(o.name),this.authService.storeUserGamiPts(o.meta._gamipress_pts_points);const n=new p.Lr({Authorization:`Bearer ${this.authService.getToken()}`});return this.http.get(`https://k-studio.co.il/wp-json/custom-api/v1/user-role/${o.id}`,{headers:n})}),(0,l.n)(o=>{const n=o.roles[0];if(this.authService.storeUserRole(n),"administrator"===n)return(0,h.of)({skipAmelia:!0,customerId:null,packages:[]});const T=`https://k-studio.co.il/wp-json/custom-api/v1/amelia-customer-id?email=${this.authService.getUserEmail()}`;return this.http.get(T)}),(0,l.n)(o=>o.skipAmelia?(0,h.of)(o):(o&&o.customerId&&this.authService.storeCustomerID(o.customerId),this.http.get(`https://k-studio.co.il/wp-json/wn/v1/package-purchases/${o.customerId}`))),(0,l.n)(o=>{if(o.skipAmelia)return(0,h.of)(o);if(console.log("package response:",o),o&&o.data&&o.data[0]&&o.data[0].packages[0]&&o.data[0].packages[0].purchases[0]&&o.data[0].packages[0].purchases[0].packageCustomerId){const s=o.data[0].packages[0].purchases[0].packageCustomerId;console.log("packageID:",s),this.authService.storePackageCustomerID(s)}const n=`https://k-studio.co.il/wp-json/custom-api/v1/get-favorite-location?user_id=${this.authService.getUserID()}`;return this.http.get(n)}),(0,D.M)(o=>{o.skipAmelia||(console.log("favlocation",o),console.log("favlocation",o.favorite_location),o&&o.favorite_location&&this.authService.storeFavLocation(o.favorite_location))}),(0,P.W)(o=>(console.error("Error occurred during login process:",o),this.authService.logout(),401===o.status||403===o.status?(this.errorMessage="\u05e9\u05dd \u05de\u05e9\u05ea\u05de\u05e9 \u05d0\u05d5 \u05e1\u05d9\u05e1\u05de\u05d4 \u05e9\u05d2\u05d5\u05d9\u05d9\u05dd.",this.presentToast(this.errorMessage,"danger")):(this.errorMessage="\u05d0\u05d9\u05e8\u05e2\u05d4 \u05e9\u05d2\u05d9\u05d0\u05d4, \u05d0\u05e0\u05d0 \u05e0\u05e1\u05d4 \u05e9\u05e0\u05d9\u05ea",this.presentToast(this.errorMessage,"medium")),this.isLoading=!1,(0,w.$)(o)))).subscribe((0,v.A)(function*(){i.showProgressBar=!0,setTimeout(()=>{i.router.navigate(["/home"]),i.showProgressBar=!1},1500),i.isLoading=!1}),o=>{console.error("An unexpected error occurred in subscribe:",o),this.isLoading=!1})}togglePasswordVisibility(){this.passwordType="password"===this.passwordType?"text":"password",this.passwordIcon="eye-off"===this.passwordIcon?"eye":"eye-off"}forgotPassword(){console.log("Forgot password clicked")}scrollToInput(i){const o=i.target;setTimeout(()=>{o.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},300)}}return(e=a).\u0275fac=function(i){return new(i||e)(t.rXU(M.u),t.rXU(d.Ix),t.rXU(p.Qq),t.rXU(u.K_))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-login"]],decls:19,vars:8,consts:[[1,"background-container"],[1,"background-image"],[1,"overlay"],[1,"logo-container"],["src","https://k-studio.co.il/wp-content/uploads/2022/11/\u05dc\u05d5\u05d2\u05d5-\u05db\u05d9\u05ea\u05d5\u05d1-\u05e2\u05d2\u05d5\u05dc-\u05d8\u05d5\u05e8\u05e7\u05d9\u05d6-\u05e9\u05e7\u05d5\u05e3-01-scaled.webp","alt","Logo"],[1,"form-container"],[1,"login-form",3,"ngSubmit"],[1,"welcome-message",2,"direction","rtl","text-align","center"],[1,"email-container"],["type","email","name","email","required","","label","\u05e9\u05dd \u05de\u05e9\u05ea\u05de\u05e9","label-placement","floating","placeholder","\u05d4\u05e7\u05dc\u05d3 \u05d0\u05ea \u05e9\u05dd \u05d4\u05de\u05e9\u05ea\u05de\u05e9",3,"ngModelChange","focus","ngModel"],[1,"password-container",2,"position","relative"],["name","password","required","","label","\u05e1\u05d9\u05e1\u05de\u05d4","label-placement","floating","placeholder","\u05d4\u05db\u05e0\u05e1 \u05e1\u05d9\u05e1\u05de\u05d4",3,"ngModelChange","focus","ngModel","type"],[1,"password-toggle-icon",2,"position","absolute","right","15px","top","25px","font-size","20px",3,"click","name"],[1,"login-btn",3,"click","disabled"],["name","crescent",4,"ngIf"],[4,"ngIf"],["type","indeterminate","color","success",4,"ngIf"],["name","crescent"],["type","indeterminate","color","success"]],template:function(i,o){1&i&&(t.j41(0,"ion-content")(1,"div",0),t.nrm(2,"div",1)(3,"div",2),t.j41(4,"div",3),t.nrm(5,"img",4),t.k0s()(),t.j41(6,"div",5)(7,"form",6),t.bIt("ngSubmit",function(){return o.login()}),t.j41(8,"h2",7),t.EFF(9,"\u05d1\u05e8\u05d5\u05da \u05d4\u05d1\u05d0!"),t.k0s(),t.j41(10,"div",8)(11,"ion-input",9),t.mxI("ngModelChange",function(s){return t.DH7(o.username,s)||(o.username=s),s}),t.bIt("focus",function(s){return o.scrollToInput(s)}),t.k0s()(),t.j41(12,"div",10)(13,"ion-input",11),t.mxI("ngModelChange",function(s){return t.DH7(o.password,s)||(o.password=s),s}),t.bIt("focus",function(s){return o.scrollToInput(s)}),t.k0s(),t.j41(14,"ion-icon",12),t.bIt("click",function(){return o.togglePasswordVisibility()}),t.k0s()(),t.j41(15,"button",13),t.bIt("click",function(){return o.login()}),t.DNE(16,k,1,0,"ion-spinner",14)(17,E,2,0,"span",15),t.k0s()(),t.DNE(18,C,1,0,"ion-progress-bar",16),t.k0s()()),2&i&&(t.R7$(11),t.R50("ngModel",o.username),t.R7$(2),t.R50("ngModel",o.password),t.Y8G("type",o.passwordType),t.R7$(),t.Y8G("name",o.passwordIcon),t.R7$(),t.Y8G("disabled",o.isLoading),t.R7$(),t.Y8G("ngIf",o.isLoading),t.R7$(),t.Y8G("ngIf",!o.isLoading),t.R7$(),t.Y8G("ngIf",o.showProgressBar))},dependencies:[f.bT,c.qT,c.BC,c.cb,c.YS,c.vS,c.cV,u.W9,u.iq,u.$w,u.FH,u.w2,u.Gw],styles:[".password-container[_ngcontent-%COMP%]{position:relative}.password-toggle-icon[_ngcontent-%COMP%]{position:absolute;right:15px;top:25px;font-size:20px;color:#666;cursor:pointer}.background-container[_ngcontent-%COMP%]{position:relative;width:100%;height:40vh;z-index:1}.background-image[_ngcontent-%COMP%]{background-image:url(https://k-studio.co.il/wp-content/uploads/2024/11/cover.jpeg);background-size:cover;background-position:center;height:100%}.logo-container[_ngcontent-%COMP%]{position:absolute;top:20px;width:100%;display:flex;justify-content:center;z-index:2}.logo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;height:auto}.form-container[_ngcontent-%COMP%]{position:relative;background-color:#fff;border-top-left-radius:25px;border-top-right-radius:25px;padding:20px;margin-top:-25px;width:100%;z-index:2;height:30%}.welcome-message[_ngcontent-%COMP%]{font-size:24px;font-weight:700;margin-bottom:10px;color:#333}.login-form[_ngcontent-%COMP%]{max-width:400px;margin:0 auto}.email-container[_ngcontent-%COMP%]{margin-bottom:20px}ion-input[_ngcontent-%COMP%]{color:#000;font-family:Arial,sans-serif;font-size:16px;padding:10px;background-color:#dbdbdb;text-indent:20px;border-radius:25px}ion-content[_ngcontent-%COMP%]{--keyboard-offset: 0px;height:100vh}.keyboard-open[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{height:calc(100vh - 50px);overflow-y:auto}.login-btn[_ngcontent-%COMP%]{background:#37c6c2;border-radius:25px;font-weight:700;font-size:18px;padding:10px 0;margin-top:20px;width:100%;background-activated:#744114;--background:#37c6c2;--border-radius: 25px;--background-activated: #744114;color:#fff}.login-btn[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.login-btn[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle}"]}),a})()}];let L=(()=>{var e;class a{}return(e=a).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[d.iI.forChild(y),d.iI]}),a})(),I=(()=>{var e;class a{}return(e=a).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[f.MD,c.YN,u.bv,L]}),a})()}}]);