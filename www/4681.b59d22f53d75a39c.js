"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4681],{689:(Ct,ht,k)=>{k.d(ht,{p:()=>J});var r=k(1626),T=k(1985),K=k(6354),W=k(9437),bt=k(7673),t=k(7468),A=k(8141),et=k(8810);var rt=k(3953),st=k(3656),Q=k(3931),at=k(4796);let J=(()=>{var S;class z{constructor(E,H,R,X){this.platform=E,this.httpA=H,this.http=R,this.authService=X,this.headers=new r.Lr({"Content-Type":"application/json",Amelia:"C7YZnwLJ90FF42GOCkEFT9z856v6r5SQ2QWpdhGBexQk"}),this.apiUrl="https://k-studio.co.il/wp-json/custom-api/v1"}getLast60DaysAppointmentsForUser(){const E=new Date,H=this.formatDate(new Date(E.setDate(E.getDate()+30))),X=`https://k-studio.co.il/wp-admin/admin-ajax.php?action=wpamelia_api&call=/api/v1/appointments&dates=${this.formatDate(new Date(E.setDate(E.getDate()-60)))},${H}&skipServices=1&skipProviders=1`,Y=this.authService.getUserEmail(),w={Amelia:"C7YZnwLJ90FF42GOCkEFT9z856v6r5SQ2QWpdhGBexQk"};return new T.c(P=>{this.platform.ready().then(()=>{this.platform.is("cordova")?this.httpA.get(X,{},w).then(q=>{var tt;const yt=(null===(tt=JSON.parse(q.data).data)||void 0===tt?void 0:tt.appointments)||{};let Mt=[];for(const ft in yt)yt.hasOwnProperty(ft)&&Array.isArray(yt[ft].appointments)&&yt[ft].appointments.forEach(lt=>{lt.bookings&&Array.isArray(lt.bookings)&&lt.bookings.forEach(ot=>{var mt;if((null===(mt=ot.customer)||void 0===mt?void 0:mt.email)===Y){ot.googleCalendarEventId=lt.googleCalendarEventId;const $={...lt,matchedBooking:ot,userBookingStatus:ot.status};Mt.push($)}})});P.next(Mt),P.complete()}).catch(q=>{P.error(`Error fetching appointments: ${q}`)}):this.http.get(X,{headers:this.headers}).subscribe(q=>{var tt;const xt=(null===(tt=q.data)||void 0===tt?void 0:tt.appointments)||{};let yt=[];for(const Mt in xt)xt.hasOwnProperty(Mt)&&Array.isArray(xt[Mt].appointments)&&xt[Mt].appointments.forEach(ft=>{ft.bookings&&Array.isArray(ft.bookings)&&ft.bookings.forEach(lt=>{var ot;if((null===(ot=lt.customer)||void 0===ot?void 0:ot.email)===Y){lt.googleCalendarEventId=ft.googleCalendarEventId;const mt={...ft,matchedBooking:lt,userBookingStatus:lt.status};yt.push(mt)}})});P.next(yt),P.complete()},q=>{P.error(`Error fetching appointments: ${q}`)})})})}fetchSubscriptionExpiryDate(E){return this.http.get(`https://k-studio.co.il/wp-json/custom-api/v1/subscription-dates/?user_id=${E}`).pipe((0,K.T)(R=>{if(!R||0===R.length)return{expiryDate:"\u05dc\u05d0 \u05e0\u05de\u05e6\u05d0 \u05de\u05e0\u05d5\u05d9 \u05d1\u05ea\u05d5\u05e7\u05e3"};const X=R[0],Y=X.status;let w,P=new Date;return"active"===Y?(P=0!=X.expiry_date?new Date(X.expiry_date):new Date(X.renewal_date),w=`${P.getDate().toString().padStart(2,"0")}/${(P.getMonth()+1).toString().padStart(2,"0")}/${P.getFullYear()}`,this.storeSubscriptionExpiryDate(w),w="\u05ea\u05d5\u05e7\u05e3 \u05d4\u05de\u05e0\u05d5\u05d9: "+w):w="on-hold"===Y?"\u05d4\u05de\u05e0\u05d5\u05d9 \u05de\u05d5\u05e9\u05d4\u05d4":"\u05dc\u05d0 \u05e0\u05de\u05e6\u05d0 \u05de\u05e0\u05d5\u05d9 \u05d1\u05ea\u05d5\u05e7\u05e3",{expiryDate:w}}))}fetchAvailablePackageSlots(E){return this.http.get(`https://k-studio.co.il/wp-json/wn/v1/package-purchases/${E}`,{}).pipe((0,K.T)(R=>{if(R&&R.data&&R.data.length>0){const X=R.data[0].packages;if(X&&X.length>0){const Y=X[0].purchases,w=X[0].purchases[0].packageCustomerId;if(this.authService.storePackageCustomerID(w),Y&&Y.length>0){const P=Y[0].purchase[0].available,tt=new Date(Y[0].purchased);return tt.setDate(tt.getDate()+30),{availableSlots:P,expiryDate:`${tt.getDate().toString().padStart(2,"0")}/${(tt.getMonth()+1).toString().padStart(2,"0")}/${tt.getFullYear()}`,customerPackageID:w}}}}return{availableSlots:0,expiryDate:""}}),(0,W.W)(R=>(console.error("API Error:",R),(0,bt.of)({availableSlots:0,expiryDate:""}))))}fetchSubscriptionData(E,H){const X=`https://k-studio.co.il/wp-json/wn/v1/package-purchases/${H}`;return(0,t.p)({subscription:this.http.get(`https://k-studio.co.il/wp-json/custom-api/v1/subscription-dates/?user_id=${E}`).pipe((0,K.T)(Y=>{if(!Y||0===Y.length)return{subscriptionId:0,expiryDate:"\u05dc\u05d0 \u05e0\u05de\u05e6\u05d0 \u05de\u05e0\u05d5\u05d9 \u05d1\u05ea\u05d5\u05e7\u05e3"};const w=Y[0],P=w.status;let q,tt=new Date;return"active"===P?(tt=0!=w.expiry_date?new Date(w.expiry_date):new Date(w.renewal_date),q=`${tt.getDate().toString().padStart(2,"0")}/${(tt.getMonth()+1).toString().padStart(2,"0")}/${tt.getFullYear()}`,this.storeSubscriptionExpiryDate(q),q="\u05ea\u05d5\u05e7\u05e3 \u05d4\u05de\u05e0\u05d5\u05d9: "+q):q="on-hold"===P?"\u05d4\u05de\u05e0\u05d5\u05d9 \u05de\u05d5\u05e9\u05d4\u05d4":"\u05dc\u05d0 \u05e0\u05de\u05e6\u05d0 \u05de\u05e0\u05d5\u05d9 \u05d1\u05ea\u05d5\u05e7\u05e3",{subscriptionId:w.subscription_id,expiryDate:q}})),packageSlots:this.http.get(X).pipe((0,K.T)(Y=>{if(Y&&Y.data&&Y.data.length>0){const w=Y.data[0].packages;if(w&&w.length>0){const P=w[0].purchases;if(this.authService.storePackageCustomerID(P[0].packageCustomerId),P&&P.length>0)return{availableSlots:P[0].purchase[0].available}}}return{availableSlots:0}}),(0,W.W)(Y=>(console.error("Package API Error:",Y),(0,bt.of)({availableSlots:0}))))}).pipe((0,K.T)(({subscription:Y,packageSlots:w})=>({subscriptionId:Y.subscriptionId,expiryDate:Y.expiryDate,availableSlots:w.availableSlots})))}getUserPackageCustomerID(){const H=`https://k-studio.co.il/wp-json/wn/v1/package-purchases/${this.authService.getPackageCustomerId()}`;return this.http.get(H,{}).pipe((0,K.T)(R=>{R&&R.data&&R.data[0]&&R.data[0].packages[0]&&R.data[0].packages[0].purchases[0]&&R.data[0].packages[0].purchases[0].packageCustomerId&&this.authService.storePackageCustomerID(R.data[0].packages[0].purchases[0].packageCustomerId)}),(0,W.W)(R=>(console.error("API Error:",R),(0,bt.of)({availableSlots:0,expiryDate:""}))))}fetchUserPurchases(E){return this.http.get(`https://k-studio.co.il/wp-json/wn/v1/user-purchases/${E}`,{}).pipe((0,K.T)(R=>(R.forEach(X=>{X.invoice_link||(X.invoice_link="")}),R||[])),(0,W.W)(R=>(console.error("Error fetching user purchases:",R),(0,bt.of)([]))))}updateFavoriteLocation(E){const R="https://k-studio.co.il/wp-json/custom-api/v1/set-favorite-location?user_id="+this.authService.getUserID();return this.http.post(R,{favorite_location:E}).pipe((0,A.M)(()=>console.log("HTTP request sent")),(0,K.T)(Y=>(this.authService.storeFavLocation(E),Y)),(0,W.W)(Y=>(console.error("HTTP Error:",Y),(0,et.$)(()=>new Error("Failed to update favorite location")))))}cancelBooking(E){return this.http.post(`https://k-studio.co.il/wp-json/wn/v1/cancel-booking/${E}`,{})}formatDate(E){return`${E.getFullYear()}-${(E.getMonth()+1).toString().padStart(2,"0")}-${E.getDate().toString().padStart(2,"0")}`}storeSubscriptionExpiryDate(E){localStorage.setItem("subscription_expiry_date",E)}getSubscriptionExpiryDate(){return localStorage.getItem("subscription_expiry_date")}addNote(E,H,R,X){return this.http.post(`${this.apiUrl}/add-note`,{userID:E,title:H,content:R,color:X})}removeNote(E){return this.http.post(`${this.apiUrl}/remove-note`,{note_id:E})}editNote(E,H,R,X){return this.http.post(`${this.apiUrl}/edit-note`,{note_id:E,title:H,content:R,color:X})}getNotesByUser(E){return this.http.get(`${this.apiUrl}/get-notes-by-user?user_id=${E}`)}}return(S=z).\u0275fac=function(E){return new(E||S)(rt.KVO(st.OD),rt.KVO(Q.B),rt.KVO(r.Qq),rt.KVO(at.u))},S.\u0275prov=rt.jDH({token:S,factory:S.\u0275fac,providedIn:"root"}),z})()},6387:(Ct,ht,k)=>{k.d(ht,{T:()=>Bt});var r=k(467),T=k(9969),K=k(1626),W=k(7586),bt=k(4843),t=k(3953),A=k(791),et=k(4938),O=k(177);function rt(v,D){if(1&v&&(t.j41(0,"div",9)(1,"h3",10),t.EFF(2),t.k0s(),t.j41(3,"p",11),t.EFF(4),t.k0s()()),2&v){const h=D.$implicit,e=t.XpG();t.R7$(2),t.JRh(e.getDayInHebrew(h.name)),t.R7$(2),t.JRh(h.date)}}function st(v,D){if(1&v&&(t.j41(0,"div")(1,"p",16),t.EFF(2),t.k0s(),t.j41(3,"p",17),t.EFF(4),t.k0s()()),2&v){const h=t.XpG().$implicit,e=t.XpG().$implicit;t.R7$(2),t.JRh(h.trainings[e].time),t.R7$(2),t.JRh(h.trainings[e].title)}}function Q(v,D){1&v&&(t.j41(0,"div")(1,"p",18),t.EFF(2,"-"),t.k0s()())}function at(v,D){if(1&v&&(t.j41(0,"div",14),t.DNE(1,st,5,2,"div",15)(2,Q,3,0,"div",15),t.k0s()),2&v){const h=D.$implicit,e=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf",h.trainings[e]),t.R7$(),t.Y8G("ngIf",!h.trainings[e])}}function J(v,D){if(1&v&&(t.j41(0,"div",12),t.DNE(1,at,3,2,"div",13),t.k0s()),2&v){const h=t.XpG();t.R7$(),t.Y8G("ngForOf",h.days)}}let S=(()=>{var v;class D{constructor(e,i){this.modalCtrl=e,this.ameliaService=i,this.branch="main",this.days=[],this.hebrewDaysMap={Sunday:"\u05e8\u05d0\u05e9\u05d5\u05df",Monday:"\u05e9\u05e0\u05d9",Tuesday:"\u05e9\u05dc\u05d9\u05e9\u05d9",Wednesday:"\u05e8\u05d1\u05d9\u05e2\u05d9",Thursday:"\u05d7\u05de\u05d9\u05e9\u05d9",Friday:"\u05e9\u05d9\u05e9\u05d9",Saturday:"\u05e9\u05d1\u05ea"},this.daysOfWeekEnglish=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}ngOnInit(){this.loadWeeklyTrainings()}loadWeeklyTrainings(){const e=this.ameliaService.getTrainingsTitles(this.branch);this.days=this.daysOfWeekEnglish.map((i,l)=>({name:i,date:W().day(l).format("DD/MM/YYYY"),trainings:e[i]||[]}))}refreshTrainings(){var e=this;return(0,r.A)(function*(){try{yield e.ameliaService.fetchTitleTrainings("main"),e.loadWeeklyTrainings()}catch(i){console.error("Error refreshing trainings:",i)}try{yield e.ameliaService.fetchTitleTrainings("second"),e.loadWeeklyTrainings()}catch(i){console.error("Error refreshing trainings:",i)}})()}getDayInHebrew(e){return this.hebrewDaysMap[e]||e}getMaxTrainingsLength(){return Math.max(...this.days.map(e=>e.trainings.length),0)}getRange(e){return Array.from({length:e},(i,l)=>l)}getDayName(e){return this.daysOfWeekEnglish[e%7]}getDateByOffset(e){return W().add(e,"days").format("DD/MM/YYYY")}getBranchTitle(){return"main"===this.branch?"\u05e1\u05e0\u05d9\u05e3 \u05e8\u05d0\u05e9\u05d9":"\u05e1\u05e0\u05d9\u05e3 \u05de\u05e9\u05e0\u05d9"}dismiss(){this.modalCtrl.dismiss()}}return(v=D).\u0275fac=function(e){return new(e||v)(t.rXU(A.W3),t.rXU(et.J))},v.\u0275cmp=t.VBU({type:v,selectors:[["app-calendar-popup"]],inputs:{weeklyData:"weeklyData",branch:"branch"},decls:13,vars:2,consts:[[1,"modal-title"],["slot","end"],["fill","clear",3,"click"],[1,"modal-content"],[1,"calendar-table-wrapper"],[1,"calendar-table"],[1,"table-header"],["class","day-header",4,"ngFor","ngForOf"],["class","table-row",4,"ngFor","ngForOf"],[1,"day-header"],[1,"dayName"],[1,"dayDate"],[1,"table-row"],["class","table-cell training-cell",4,"ngFor","ngForOf"],[1,"table-cell","training-cell"],[4,"ngIf"],[1,"training-time"],[1,"training-title"],[1,"empty-slot"]],template:function(e,i){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",0),t.EFF(3,"\u05d4\u05d0\u05d9\u05de\u05d5\u05e0\u05d9\u05dd \u05d4\u05e7\u05e8\u05d5\u05d1\u05d9\u05dd"),t.k0s(),t.j41(4,"ion-buttons",1)(5,"ion-button",2),t.bIt("click",function(){return i.dismiss()}),t.EFF(6,"\u05e1\u05d2\u05d5\u05e8"),t.k0s()()()(),t.j41(7,"ion-content",3)(8,"div",4)(9,"div",5)(10,"div",6),t.DNE(11,rt,5,2,"div",7),t.k0s(),t.DNE(12,J,2,1,"div",8),t.k0s()()()),2&e&&(t.R7$(11),t.Y8G("ngForOf",i.days),t.R7$(),t.Y8G("ngForOf",i.getRange(i.getMaxTrainingsLength())))},dependencies:[O.Sq,O.bT,A.Jm,A.QW,A.W9,A.eU,A.BC,A.ai],styles:[".modal-title[_ngcontent-%COMP%]{font-size:18px;font-weight:700}.modal-content[_ngcontent-%COMP%]{--background: #f8f9fa;padding:16px}.calendar-table-wrapper[_ngcontent-%COMP%]{overflow-x:auto;white-space:nowrap;padding:8px}.calendar-table[_ngcontent-%COMP%]{display:grid;gap:1px;min-width:700px;background-color:#ddd}.table-header[_ngcontent-%COMP%]{display:contents}.day-header[_ngcontent-%COMP%]{background:#f60;color:#fff;text-align:center;padding:8px;border-radius:6px 6px 0 0;font-size:14px;font-weight:700}.table-row[_ngcontent-%COMP%]{display:contents}.table-cell[_ngcontent-%COMP%]{background:#fff;text-align:center;padding:8px;font-size:14px;min-height:60px}.training-time[_ngcontent-%COMP%]{font-weight:700;font-size:14px;margin:0;color:#333}.training-title[_ngcontent-%COMP%]{font-size:12px;margin:4px 0 0;color:#555}.empty-slot[_ngcontent-%COMP%]{color:#ccc;font-size:14px}@media (max-width: 768px){.calendar-table[_ngcontent-%COMP%]{grid-template-columns:repeat(7,minmax(120px,1fr))}.day-header[_ngcontent-%COMP%], .training-time[_ngcontent-%COMP%]{font-size:12px}}.dayName[_ngcontent-%COMP%]{font-size:14px;font-weight:500}.dayDate[_ngcontent-%COMP%]{font-size:12px;margin-top:-20px;text-decoration:none;font-weight:200}"]}),D})(),z=(()=>{var v;class D{constructor(e){this.http=e,this.apiUrl="https://k-studio.co.il/wp-json/training-music/v1",this.clientId="b46968a8339c459181a8fc6057ec0438",this.clientSecret="c7757feb5518452cafe80565af400216",this.refreshToken="AQC9oH-UuUUDtAsHJ1NBsvmWb634P8eFEFRT6i86SkTDNme8MSTV3g4gT-SJJVCbq-8xoja2TLbw5G0rntYZnFBFYElIwmVTU4MT3c8NLFNTmy1SDa3DmGkAc-G7aRc9yeg",this.spotifyUserId="",this.backupPlaylistId="37i9dQZF1DX76Wlfdnj7AP",this.getSpotifyUserId()}getSpotifyToken(){var e=this;return(0,r.A)(function*(){const i=yield fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+btoa(e.clientId+":"+e.clientSecret)},body:`grant_type=refresh_token&refresh_token=${e.refreshToken}`});if(!i.ok){const f=yield i.text();throw console.error("Spotify Token Error:",f),new Error("Failed to refresh Spotify token")}return(yield i.json()).access_token})()}getSpotifyUserId(){var e=this;return(0,r.A)(function*(){const i=yield e.getSpotifyToken(),l=yield fetch("https://api.spotify.com/v1/me",{headers:{Authorization:`Bearer ${i}`}});if(!l.ok)return void console.error("Error fetching Spotify User ID");const f=yield l.json();e.spotifyUserId=f.id})()}searchSongs(e){var i=this;return(0,r.A)(function*(){var l;const f=yield i.getSpotifyToken(),M=yield fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(e)}&type=track&limit=10`,{headers:{Authorization:`Bearer ${f}`}});if(!M.ok){const V=yield M.text();throw console.error("Spotify Search Error:",V),new Error("Failed to fetch songs from Spotify")}return((null===(l=(yield M.json()).tracks)||void 0===l?void 0:l.items)||[]).filter(V=>V&&V.duration_ms&&!isNaN(V.duration_ms))})()}getSongsForTraining(e){return this.http.get(`${this.apiUrl}/get-songs/?training_id=${e}`)}addSongToTraining(e,i,l){var f,M;const C={training_id:e,user_id:i,song_id:l.id,song_name:l.name,artist_name:(null===(f=l.artists[0])||void 0===f?void 0:f.name)||"UNKNOWN",artist_image:(null===(M=l.album)||void 0===M||null===(M=M.images[0])||void 0===M?void 0:M.url)||"UNKNOWN",duration_ms:l.duration_ms};return this.http.post(`${this.apiUrl}/add-song`,C)}removeSongFromTraining(e,i,l){return this.http.post(`${this.apiUrl}/remove-song/`,{training_id:e,user_id:i,song_id:l})}createPlaylist(e,i){var l=this;return(0,r.A)(function*(){if(!l.spotifyUserId)throw console.error("\u274c Spotify User ID not available"),new Error("Spotify User ID not available");yield l.deleteOldPlaylists();const f=i.reduce((L,G)=>{const V=G.duration_ms||(null==G?void 0:G.duration)||0,dt="string"==typeof V?parseInt(V):V;return isNaN(dt)?(console.warn(`\u26a0\ufe0f Invalid duration for song: ${G.song_name||"Unknown"}:`,V),L):L+dt/1e3},0),M=yield l.getSpotifyToken(),C=`https://api.spotify.com/v1/users/${l.spotifyUserId}/playlists`;try{const L=yield l.http.post(C,{name:e,description:"Training Playlist",public:!1},{headers:new K.Lr({Authorization:`Bearer ${M}`,"Content-Type":"application/json"})}).toPromise();if(null==L||!L.id)return console.error("\u274c Failed to create playlist: No ID returned"),null;const G=L.id;let V=[...i];if(f<3600){const ut=3600-f,nt=yield l.getBackupSongs(ut);V=[...i,...nt]}const dt=V.map(ut=>{const nt=ut.song_id||ut.id;return nt?`spotify:track:${nt}`:(console.warn(`\u26a0\ufe0f Missing song ID for: ${ut.song_name||"Unknown song"}`),null)}).filter(ut=>null!==ut);return 0===dt.length?(console.error("\u274c No valid songs to add. Aborting playlist creation."),null):(yield l.addSongsToPlaylist(G,dt),G)}catch(L){return console.error("\u274c Error creating playlist:",L),null}})()}getBackupSongs(e){var i=this;return(0,r.A)(function*(){const l=yield i.getSpotifyToken(),M=new K.Lr({Authorization:`Bearer ${l}`});try{const C=yield i.http.get("https://api.spotify.com/v1/me/playlists",{headers:M}).toPromise();if(!C||!C.items)return console.error("Error: Unable to fetch user playlists.",C),[];const L=C.items.find(pt=>pt.name.toLowerCase().includes("backup"));if(!L)return console.error("\u274c Error: No backup playlist found."),[];const V=`https://api.spotify.com/v1/playlists/${L.id}/tracks`,dt=yield i.http.get(V,{headers:M}).toPromise();if(!dt||!dt.items)return console.error("\u274c Error: No tracks found in backup playlist."),[];let ut=dt.items.map(pt=>pt.track);ut=ut.filter(pt=>pt&&pt.id&&pt.duration_ms&&!isNaN(pt.duration_ms));let nt=0;const vt=[];for(const pt of ut){if(nt+pt.duration_ms/1e3>e)break;vt.push(pt),nt+=pt.duration_ms/1e3}return vt}catch(C){return console.error("\u274c Error fetching backup songs:",C),[]}})()}addSongsToPlaylist(e,i){var l=this;return(0,r.A)(function*(){if(!e||"undefined"===e)return void console.error("\u274c Invalid playlist ID:",e);if(!i.length)return void console.error("\u274c No songs to add.");const f=yield l.getSpotifyToken(),M=`https://api.spotify.com/v1/playlists/${e}/tracks`,C=new K.Lr({Authorization:`Bearer ${f}`,"Content-Type":"application/json"}),L={uris:i.filter(G=>G.startsWith("spotify:track:"))};if(0!==L.uris.length)try{yield l.http.post(M,L,{headers:C}).toPromise()}catch(G){console.error("\u274c Error adding songs to playlist:",G)}else console.error("\u274c No valid track URIs found. Aborting song addition.")})()}getUserPlaylist(){var e=this;return(0,r.A)(function*(){const i=yield e.getSpotifyToken(),f=new K.Lr({Authorization:`Bearer ${i}`,"Content-Type":"application/json"});let M=[],C="https://api.spotify.com/v1/me/playlists?limit=50&market=US";try{for(;C;){let L="";if(L=yield e.http.get(C,{headers:f}).toPromise().catch(()=>({items:[],next:null})),!L||!L.items){console.warn("Spotify API returned an empty response.");break}M=M.concat(L.items),C=L.next}return M}catch(L){return console.error("Error fetching user playlists:",L),[]}})()}deleteOldPlaylists(){var e=this;return(0,r.A)(function*(){const i=yield e.getUserPlaylist(),l=new Date;l.setDate(l.getDate()-2);for(const f of i)f.name.startsWith("Training -")&&new Date(f.name.split(" - ")[1])<l&&(yield e.deletePlaylist(f.id))})()}deletePlaylist(e){var i=this;return(0,r.A)(function*(){const l=yield i.getSpotifyToken(),f=`https://api.spotify.com/v1/playlists/${e}/followers`,M=new K.Lr({Authorization:`Bearer ${l}`,"Content-Type":"application/json"});try{yield i.http.delete(f,{headers:M}).toPromise()}catch(C){console.error(`Error deleting playlist ${e}`,C)}})()}}return(v=D).\u0275fac=function(e){return new(e||v)(t.KVO(K.Qq))},v.\u0275prov=t.jDH({token:v,factory:v.\u0275fac,providedIn:"root"}),D})();var j=k(4796),E=k(9417);const H=["searchInput"],R=["selectedSongsList"],X=(v,D)=>({"fade-in":v,"fade-out":D});function Y(v,D){1&v&&(t.j41(0,"div",14),t.nrm(1,"ion-spinner",15),t.k0s())}function w(v,D){if(1&v){const h=t.RV6();t.j41(0,"ion-button",22),t.bIt("click",function(){t.eBV(h);const i=t.XpG().$implicit,l=t.XpG(2);return t.Njj(l.addSong(i))}),t.nrm(1,"ion-icon",23),t.k0s()}}function P(v,D){if(1&v&&(t.j41(0,"ion-item",18)(1,"ion-thumbnail",19),t.nrm(2,"img",20),t.k0s(),t.j41(3,"ion-label")(4,"h2"),t.EFF(5),t.k0s(),t.j41(6,"p"),t.EFF(7),t.k0s()(),t.DNE(8,w,2,0,"ion-button",21),t.k0s()),2&v){const h=D.$implicit,e=t.XpG(2);t.R7$(2),t.Y8G("src",(null==h.album||null==h.album.images[0]?null:h.album.images[0].url)||"assets/default-artist.png",t.B4B),t.R7$(3),t.JRh(h.name),t.R7$(2),t.JRh(null==h.artists[0]?null:h.artists[0].name),t.R7$(),t.Y8G("ngIf",!e.isAddedToSelectedSongs(h))}}function q(v,D){if(1&v&&(t.j41(0,"ion-list",16),t.DNE(1,P,9,4,"ion-item",17),t.k0s()),2&v){const h=t.XpG();t.R7$(),t.Y8G("ngForOf",h.searchResults)}}function tt(v,D){if(1&v){const h=t.RV6();t.j41(0,"ion-button",27),t.bIt("click",function(){t.eBV(h);const i=t.XpG().$implicit,l=t.XpG();return t.Njj(l.removeSong(i))}),t.nrm(1,"ion-icon",28),t.k0s()}}function xt(v,D){if(1&v&&(t.j41(0,"ion-item",24)(1,"ion-thumbnail",19),t.nrm(2,"img",25),t.k0s(),t.j41(3,"ion-label")(4,"h2"),t.EFF(5),t.k0s(),t.j41(6,"p"),t.EFF(7),t.k0s()(),t.DNE(8,tt,2,0,"ion-button",26),t.k0s()),2&v){const h=D.$implicit,e=t.XpG();t.Y8G("ngClass",t.l_i(5,X,h.isNew,h.isFadingOut)),t.R7$(2),t.Y8G("src",h.artist_image,t.B4B),t.R7$(3),t.JRh(h.song_name),t.R7$(2),t.JRh(h.artist_name),t.R7$(),t.Y8G("ngIf",h.user_id===e.userId||"administrator"===e.userRole||"team"===e.userRole)}}function yt(v,D){if(1&v){const h=t.RV6();t.j41(0,"ion-fab",29)(1,"ion-fab-button",30),t.bIt("click",function(){t.eBV(h);const i=t.XpG();return t.Njj(i.createSpotifyPlaylist())}),t.nrm(2,"ion-icon",31),t.k0s()()}}let Mt=(()=>{var v;class D{constructor(e,i,l,f,M){this.modalCtrl=e,this.spotifyService=i,this.authService=l,this.toastController=f,this.animationCtrl=M,this.searchQuery="",this.searchResults=[],this.selectedSongs=[],this.userId="",this.userRole="",this.errorMessage="",this.isSearching=!1,this.userId=this.authService.getUserID(),this.userRole=this.authService.getUserRole()}ngOnInit(){this.loadTrainingSongs()}searchSongs(){var e=this;return(0,r.A)(function*(){if(e.searchQuery.trim()){e.isSearching=!0;try{e.searchResults=yield e.spotifyService.searchSongs(e.searchQuery)}catch(i){console.error("Search error:",i),e.presentToast("Failed to search songs","danger")}finally{e.isSearching=!1}}else e.searchResults=[]})()}addSong(e){var i,l;const f={song_id:e.id,song_name:e.name,artist_name:(null===(i=e.artists[0])||void 0===i?void 0:i.name)||"Unknown Artist",artist_image:(null===(l=e.album)||void 0===l||null===(l=l.images[0])||void 0===l?void 0:l.url)||"assets/default-artist.png",user_id:this.userId,duration_ms:e.duration_ms,isNew:!0,isFadingOut:!1};this.selectedSongs.some(M=>M.song_id===f.song_id)||this.selectedSongs.push(f),this.spotifyService.addSongToTraining(this.training.id,this.userId,e).subscribe(()=>{},M=>{console.error("Error adding song:",M),this.presentToast("Failed to add song","danger"),this.selectedSongs=this.selectedSongs.filter(C=>C.song_id!==f.song_id)}),this.clearSearch(),this.animateAddSong()}removeSong(e){const i=this.selectedSongs.findIndex(l=>l.song_id===e.song_id);-1!==i&&(this.selectedSongs[i].isFadingOut=!0,setTimeout(()=>{this.selectedSongs=this.selectedSongs.filter(l=>l.song_id!==e.song_id),this.spotifyService.removeSongFromTraining(this.training.id,this.userId,e.song_id).subscribe(()=>{},l=>{console.error("Error removing song:",l),this.presentToast("Failed to remove song","danger")})},300))}animateAddSong(){setTimeout(()=>{this.selectedSongsList&&this.animationCtrl.create().addElement(this.selectedSongsList.nativeElement).duration(300).fromTo("opacity","0.5","1").fromTo("transform","scale(0.95)","scale(1)").play()},50)}loadTrainingSongs(){this.spotifyService.getSongsForTraining(this.training.id).subscribe(e=>{this.selectedSongs=e.map(i=>({...i,artist_image:i.artist_image||"assets/default-artist.png"}))},e=>{console.error("Error fetching songs:",e),this.presentToast("Failed to load songs","danger")})}clearSearch(){this.searchQuery="",this.searchResults=[],this.searchInput&&(this.searchInput.nativeElement.value="",this.searchInput.nativeElement.blur())}isAddedToSelectedSongs(e){return this.selectedSongs.some(i=>i.song_id===e.id)}getTotalDuration(){const e=this.selectedSongs.reduce((M,C)=>{const L="string"==typeof C.duration_ms?parseInt(C.duration_ms):C.duration_ms;return M+(isNaN(L)?0:L)},0),i=Math.floor(e/1e3);return`${Math.floor(i/60)}:${(i%60).toString().padStart(2,"0")}`}saveSelection(){this.modalCtrl.dismiss(this.selectedSongs)}closeModal(){this.modalCtrl.dismiss()}presentToast(e,i){var l=this;return(0,r.A)(function*(){yield(yield l.toastController.create({message:e,duration:2500,color:i,position:"bottom"})).present()})()}createSpotifyPlaylist(){var e=this;return(0,r.A)(function*(){if(!e.selectedSongs.length)return void e.presentToast("No songs in the playlist!","danger");const i=`Training - ${e.training.start_time}`;try{if(!(yield e.spotifyService.createPlaylist(i,e.selectedSongs)))return console.error("\u274c Playlist creation failed."),void e.presentToast("Failed to create playlist","danger");e.presentToast("\u05d4\u05e4\u05dc\u05d9\u05d9\u05dc\u05d9\u05e1\u05d8 \u05e0\u05d5\u05e6\u05e8 \u05d1\u05d4\u05e6\u05dc\u05d7\u05d4!","success")}catch(l){console.error("\u274c Error creating playlist:",l),e.presentToast("Failed to create playlist","danger")}})()}}return(v=D).\u0275fac=function(e){return new(e||v)(t.rXU(A.W3),t.rXU(z),t.rXU(j.u),t.rXU(A.K_),t.rXU(A.Hx))},v.\u0275cmp=t.VBU({type:v,selectors:[["app-music-modal"]],viewQuery:function(e,i){if(1&e&&(t.GBs(H,5),t.GBs(R,5)),2&e){let l;t.mGM(l=t.lsd())&&(i.searchInput=l.first),t.mGM(l=t.lsd())&&(i.selectedSongsList=l.first)}},inputs:{training:"training"},decls:19,vars:5,consts:[["searchInput",""],["selectedSongsList",""],[1,"music-modal-container"],["slot","end"],[1,"close-button",3,"click"],["name","close-outline"],[1,"search-container"],["placeholder","\u05d7\u05d9\u05e4\u05d5\u05e9",1,"custom-searchbar",3,"ngModelChange","ionInput","ionClear","ngModel"],["class","search-loading",4,"ngIf"],["class","search-results-list",4,"ngIf"],[1,"selected-songs-container"],[1,"selected-songs-list"],[3,"ngClass",4,"ngFor","ngForOf"],["slot","fixed","vertical","bottom","horizontal","end",4,"ngIf"],[1,"search-loading"],["name","lines-small","color","primary"],[1,"search-results-list"],["class","fade-in",4,"ngFor","ngForOf"],[1,"fade-in"],["slot","start"],[1,"song-thumbnail",3,"src"],["color","primary","fill","clear","class","add-song-btn",3,"click",4,"ngIf"],["color","primary","fill","clear",1,"add-song-btn",3,"click"],["name","add-circle-outline"],[3,"ngClass"],[1,"artist-image",3,"src"],["color","danger","fill","clear","class","remove-song-btn",3,"click",4,"ngIf"],["color","danger","fill","clear",1,"remove-song-btn",3,"click"],["name","trash-outline"],["slot","fixed","vertical","bottom","horizontal","end"],["color","success",3,"click"],["name","musical-notes-outline"]],template:function(e,i){if(1&e){const l=t.RV6();t.j41(0,"div",2)(1,"ion-header")(2,"ion-toolbar")(3,"ion-buttons",3)(4,"ion-button",4),t.bIt("click",function(){return t.eBV(l),t.Njj(i.closeModal())}),t.nrm(5,"ion-icon",5),t.k0s()(),t.j41(6,"ion-title"),t.EFF(7,"\u05e4\u05dc\u05d9\u05d9\u05dc\u05d9\u05e1\u05d8 \u05d0\u05d9\u05de\u05d5\u05df"),t.k0s()()(),t.j41(8,"ion-content")(9,"div",6)(10,"ion-searchbar",7,0),t.mxI("ngModelChange",function(M){return t.eBV(l),t.DH7(i.searchQuery,M)||(i.searchQuery=M),t.Njj(M)}),t.bIt("ionInput",function(){return t.eBV(l),t.Njj(i.searchSongs())})("ionClear",function(){return t.eBV(l),t.Njj(i.clearSearch())}),t.k0s(),t.DNE(12,Y,2,0,"div",8),t.k0s(),t.DNE(13,q,2,1,"ion-list",9),t.j41(14,"div",10)(15,"ion-list",11,1),t.DNE(17,xt,9,8,"ion-item",12),t.k0s(),t.DNE(18,yt,3,0,"ion-fab",13),t.k0s()()()}2&e&&(t.R7$(10),t.R50("ngModel",i.searchQuery),t.R7$(2),t.Y8G("ngIf",i.isSearching),t.R7$(),t.Y8G("ngIf",i.searchResults.length>0),t.R7$(4),t.Y8G("ngForOf",i.selectedSongs),t.R7$(),t.Y8G("ngIf","administrator"===i.userRole||"team"===i.userRole))},dependencies:[O.YU,O.Sq,O.bT,E.BC,E.vS,A.Jm,A.QW,A.W9,A.Q8,A.YW,A.eU,A.iq,A.uz,A.he,A.nf,A.S1,A.w2,A.Zx,A.BC,A.ai,A.Gw],styles:[".music-modal-container[_ngcontent-%COMP%]{--background: #f4f5f8;height:100%;display:flex;flex-direction:column;background:linear-gradient(135deg,#f4f5f8,#e9ecef)}.music-modal-container[_ngcontent-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: transparent;--border-width: 0}.music-modal-container[_ngcontent-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{color:#333;transition:transform .2s ease}.music-modal-container[_ngcontent-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]:active{transform:scale(.9)}.music-modal-container[_ngcontent-%COMP%]   .fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-in}.music-modal-container[_ngcontent-%COMP%]   .fade-out[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeOut .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}@keyframes _ngcontent-%COMP%_fadeOut{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.95)}}.music-modal-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#000;font-size:1.1em;font-family:Alef;line-height:15px}.music-modal-container[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]{position:relative;padding:10px;background-color:#fff}.music-modal-container[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .custom-searchbar[_ngcontent-%COMP%]{--background: #f0f0f0;transition:all .3s ease}.music-modal-container[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .custom-searchbar[_ngcontent-%COMP%]:focus{--background: #e0e0e0;box-shadow:0 2px 4px #0000001a}.music-modal-container[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .search-loading[_ngcontent-%COMP%]{position:absolute;top:50%;right:20px;transform:translateY(-50%)}.music-modal-container[_ngcontent-%COMP%]   .search-results-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{transition:background-color .3s ease}.music-modal-container[_ngcontent-%COMP%]   .search-results-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:active{background-color:#0000000d}.music-modal-container[_ngcontent-%COMP%]   .search-results-list[_ngcontent-%COMP%]   .song-thumbnail[_ngcontent-%COMP%]{border-radius:8px;transition:transform .2s ease}.music-modal-container[_ngcontent-%COMP%]   .search-results-list[_ngcontent-%COMP%]   .song-thumbnail[_ngcontent-%COMP%]:active{transform:scale(.95)}.music-modal-container[_ngcontent-%COMP%]   .selected-songs-container[_ngcontent-%COMP%]{flex-grow:1;overflow:hidden;background-color:#fff;box-shadow:0 -4px 6px #0000000d}.music-modal-container[_ngcontent-%COMP%]   .selected-songs-container[_ngcontent-%COMP%]   .selected-songs-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:15px;background-color:#f8f9fa}.music-modal-container[_ngcontent-%COMP%]   .selected-songs-container[_ngcontent-%COMP%]   .selected-songs-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:600;color:#333}.music-modal-container[_ngcontent-%COMP%]   .selected-songs-container[_ngcontent-%COMP%]   .selected-songs-header[_ngcontent-%COMP%]   .total-duration[_ngcontent-%COMP%]{color:#6c757d;font-size:.9em;background-color:#e9ecef;padding:5px 10px;border-radius:15px}.music-modal-container[_ngcontent-%COMP%]   .selected-songs-container[_ngcontent-%COMP%]   .selected-songs-list[_ngcontent-%COMP%]{height:calc(100% - 60px);overflow-y:auto;background-color:#fff;scrollbar-width:thin;scrollbar-color:#ccc #f1f3f5}.music-modal-container[_ngcontent-%COMP%]   .selected-songs-container[_ngcontent-%COMP%]   .selected-songs-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.music-modal-container[_ngcontent-%COMP%]   .selected-songs-container[_ngcontent-%COMP%]   .selected-songs-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f3f5;border-radius:10px}.music-modal-container[_ngcontent-%COMP%]   .selected-songs-container[_ngcontent-%COMP%]   .selected-songs-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#ccc;border-radius:10px}.music-modal-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 15px;--inner-padding-end: 15px;margin:5px 0;border-radius:10px;transition:background-color .3s ease}.music-modal-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:hover{--background: #f4f4f4}.music-modal-container[_ngcontent-%COMP%]   .artist-image[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;object-fit:cover;box-shadow:0 2px 4px #0000001a}.music-modal-container[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:10px}.music-modal-container[_ngcontent-%COMP%]   ion-footer[_ngcontent-%COMP%]{padding:10px;background-color:#fff;box-shadow:0 -2px 4px #0000001a}.music-modal-container[_ngcontent-%COMP%]   ion-footer[_ngcontent-%COMP%]   .save-playlist-btn[_ngcontent-%COMP%]{margin:0;height:50px;--border-radius: 10px;transition:all .3s ease}.music-modal-container[_ngcontent-%COMP%]   ion-footer[_ngcontent-%COMP%]   .save-playlist-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}"],data:{animation:[(0,T.hZ)("songListAnimation",[(0,T.kY)(":enter",[(0,T.P)(":enter",[(0,T.iF)({opacity:0,transform:"translateY(20px)"}),(0,T.yc)(50,[(0,T.i0)("300ms ease-out",(0,T.iF)({opacity:1,transform:"translateY(0)"}))])],{optional:!0})]),(0,T.kY)(":leave",[(0,T.P)(":leave",[(0,T.i0)("200ms ease-in",(0,T.iF)({opacity:0,transform:"translateX(-100%)"}))],{optional:!0})])])]}}),D})();var ft=k(3656),lt=k(689),ot=k(8507);const mt=["popup"],$=["segmentScroll"],N=["indicator"],it=["segmentButton"],kt=v=>({background:v}),_t=()=>[1,2,3,4],It=(v,D)=>({"card--shalom":v,"card--other":D}),jt=(v,D,h,e)=>({"standby-enrolled":v,loading:D,success:h,error:e}),Kt=(v,D)=>({loading:v,success:D});function Ot(v,D){1&v&&(t.j41(0,"ion-segment-button",15)(1,"ion-label"),t.EFF(2,"\u05d1\u05df \u05d9\u05d4\u05d5\u05d3\u05d4"),t.k0s()())}function Et(v,D){1&v&&(t.j41(0,"ion-segment-button",16)(1,"ion-label"),t.EFF(2,"\u05d4\u05d9\u05e8\u05e7\u05d5\u05df"),t.k0s()())}function $t(v,D){if(1&v){const h=t.RV6();t.qex(0),t.j41(1,"button",22,2),t.bIt("click",function(){const i=t.eBV(h).$implicit,l=t.XpG(2);return t.Njj(l.onDayChange(i.date))}),t.j41(3,"span",23),t.EFF(4),t.k0s(),t.j41(5,"span",23),t.EFF(6),t.k0s()(),t.bVm()}if(2&v){const h=D.$implicit,e=t.XpG(2);t.R7$(),t.AVh("active",e.selectedDay===h.date),t.Y8G("ngStyle",e.selectedDay===h.date?t.eq3(5,kt,"shalom"===e.selectedFilterAllFav?"#ff8366":"#59c7cd"):null),t.R7$(3),t.SpI("",h.day," "),t.R7$(2),t.JRh(h.formattedDate)}}function Qt(v,D){if(1&v){const h=t.RV6();t.j41(0,"ion-icon",31),t.bIt("click",function(){t.eBV(h);const i=t.XpG(3);return t.Njj(i.openCalendarPopup())}),t.k0s()}}function Ht(v,D){if(1&v){const h=t.RV6();t.j41(0,"div",24)(1,"button",25),t.bIt("click",function(i){t.eBV(h);const l=t.XpG(2);return t.Njj(l.toggleFilterDropdown(i))}),t.j41(2,"i",26),t.nrm(3,"ion-icon",27),t.k0s()(),t.j41(4,"button",28)(5,"i",29),t.DNE(6,Qt,1,0,"ion-icon",30),t.k0s()()()}if(2&v){const h=t.XpG(2);t.R7$(),t.Y8G("@buttonState",h.getDropdownState()),t.R7$(5),t.Y8G("ngIf",!h.isTrainer)}}function Ut(v,D){if(1&v&&(t.j41(0,"ion-select-option",40),t.EFF(1),t.k0s()),2&v){const h=D.$implicit;t.Y8G("value",h),t.R7$(),t.JRh(h)}}function St(v,D){if(1&v){const h=t.RV6();t.j41(0,"ion-button",41),t.bIt("click",function(){t.eBV(h);const i=t.XpG(3);return t.Njj(i.resetTypeFilter())}),t.nrm(1,"ion-icon",42),t.k0s()}}function zt(v,D){if(1&v){const h=t.RV6();t.j41(0,"ion-list",32),t.bIt("@dropdownState.done",function(i){t.eBV(h);const l=t.XpG(2);return t.Njj(l.dropdownAnimationDone(i))}),t.j41(1,"ion-item")(2,"ion-label",33),t.EFF(3,"\u05e1\u05d5\u05d2 \u05d0\u05d9\u05de\u05d5\u05df"),t.k0s(),t.j41(4,"ion-select",34),t.mxI("ngModelChange",function(i){t.eBV(h);const l=t.XpG(2);return t.DH7(l.selectedType,i)||(l.selectedType=i),t.Njj(i)}),t.bIt("ionChange",function(){t.eBV(h);const i=t.XpG(2);return t.Njj(i.onTypeChange())}),t.DNE(5,Ut,2,2,"ion-select-option",35),t.k0s(),t.DNE(6,St,2,0,"ion-button",36),t.k0s(),t.j41(7,"ion-item")(8,"ion-label",33),t.EFF(9,"\u05d6\u05de\u05d9\u05e0\u05d5\u05ea"),t.k0s(),t.j41(10,"ion-segment",37),t.mxI("ngModelChange",function(i){t.eBV(h);const l=t.XpG(2);return t.DH7(l.availabilityFilter,i)||(l.availabilityFilter=i),t.Njj(i)}),t.bIt("ionChange",function(){t.eBV(h);const i=t.XpG(2);return t.Njj(i.onFilterChange())}),t.j41(11,"ion-segment-button",38)(12,"ion-label"),t.EFF(13,"\u05d4\u05db\u05dc"),t.k0s()(),t.j41(14,"ion-segment-button",39)(15,"ion-label"),t.EFF(16,"\u05d6\u05de\u05d9\u05df \u05d1\u05dc\u05d1\u05d3"),t.k0s()()()()()}if(2&v){const h=t.XpG(2);t.Y8G("@dropdownState",h.getDropdownState()),t.R7$(4),t.R50("ngModel",h.selectedType),t.R7$(),t.Y8G("ngForOf",h.availableTypes),t.R7$(),t.Y8G("ngIf",h.selectedType),t.R7$(4),t.R50("ngModel",h.availabilityFilter)}}function Jt(v,D){if(1&v&&(t.j41(0,"div")(1,"div",17)(2,"div",18,1),t.DNE(4,$t,7,7,"ng-container",19),t.k0s()(),t.DNE(5,Ht,7,2,"div",20)(6,zt,17,5,"ion-list",21),t.k0s()),2&v){const h=t.XpG();t.R7$(4),t.Y8G("ngForOf",h.days),t.R7$(),t.Y8G("ngIf",!h.showSkeleton),t.R7$(),t.Y8G("ngIf",h.showDropdown||h.isAnimating)}}function Xt(v,D){1&v&&(t.j41(0,"ion-item",46)(1,"ion-thumbnail",47),t.nrm(2,"ion-skeleton-text",48),t.k0s(),t.j41(3,"ion-label")(4,"h3"),t.nrm(5,"ion-skeleton-text",49),t.k0s(),t.j41(6,"p"),t.nrm(7,"ion-skeleton-text",50),t.k0s(),t.j41(8,"p"),t.nrm(9,"ion-skeleton-text",51),t.k0s()()()),2&v&&(t.R7$(2),t.Y8G("animated",!0),t.R7$(3),t.Y8G("animated",!0),t.R7$(2),t.Y8G("animated",!0),t.R7$(2),t.Y8G("animated",!0))}function Wt(v,D){1&v&&(t.j41(0,"ion-list",43)(1,"ion-list-header"),t.nrm(2,"ion-skeleton-text",44),t.k0s(),t.DNE(3,Xt,10,4,"ion-item",45),t.k0s()),2&v&&(t.R7$(2),t.Y8G("animated",!0),t.R7$(),t.Y8G("ngForOf",t.lJ4(2,_t)))}function qt(v,D){if(1&v&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&v){const h=D.$implicit;t.R7$(),t.SpI(" ",h," ")}}function te(v,D){if(1&v&&(t.j41(0,"div",68)(1,"ul"),t.DNE(2,qt,2,1,"li",19),t.k0s()()),2&v){const h=t.XpG().$implicit;t.R7$(2),t.Y8G("ngForOf",h.current_participants)}}function ee(v,D){1&v&&(t.qex(0),t.j41(1,"button",69),t.nrm(2,"ion-icon",70),t.EFF(3," \u05e8\u05e9\u05d5\u05dd "),t.k0s(),t.bVm())}function Dt(v,D){1&v&&(t.qex(0),t.EFF(1," \u05e8\u05e9\u05d5\u05dd \u05dc\u05d4\u05de\u05ea\u05e0\u05d4 "),t.bVm())}function ie(v,D){1&v&&(t.qex(0),t.EFF(1," \u05d4\u05e8\u05e9\u05de\u05d4 \u05dc\u05d4\u05de\u05ea\u05e0\u05d4 "),t.bVm())}function gt(v,D){1&v&&(t.qex(0),t.nrm(1,"ion-spinner",74),t.bVm())}function Vt(v,D){1&v&&(t.qex(0),t.nrm(1,"ion-icon",70),t.bVm())}function Lt(v,D){1&v&&(t.qex(0),t.nrm(1,"ion-icon",75),t.bVm())}function Gt(v,D){if(1&v){const h=t.RV6();t.j41(0,"button",73),t.bIt("click",function(){let i;t.eBV(h);const l=t.XpG(2).$implicit,f=t.XpG();return t.Njj(f.addToStandbyList(null!==(i=l)&&void 0!==i?i:0,f.userId,f.userEmail))}),t.DNE(1,Dt,2,0,"ng-container",12)(2,ie,2,0,"ng-container",12)(3,gt,2,0,"ng-container",12)(4,Vt,2,0,"ng-container",12)(5,Lt,2,0,"ng-container",12),t.k0s()}if(2&v){const h=t.XpG(2).$implicit;t.Y8G("ngClass",t.ziG(7,jt,h.isStandbyEnrolled,h.isStandbyLoading&&!h.isStandbyEnrolled,h.isStandbySuccess&&!h.isStandbyEnrolled,h.isError&&!h.isStandbyEnrolled))("disabled",h.isStandbyEnrolled||h.isStandbyLoading||h.isStandbySuccess||h.isError),t.R7$(),t.Y8G("ngIf",h.isStandbyEnrolled),t.R7$(),t.Y8G("ngIf",!(h.isStandbyEnrolled||h.isStandbyLoading||h.isStandbySuccess||h.isError)),t.R7$(),t.Y8G("ngIf",!h.isStandbyEnrolled&&h.isStandbyLoading),t.R7$(),t.Y8G("ngIf",!h.isStandbyEnrolled&&h.isStandbySuccess),t.R7$(),t.Y8G("ngIf",!h.isStandbyEnrolled&&h.isError)}}function Pt(v,D){1&v&&(t.qex(0),t.EFF(1,"\u05d4\u05e8\u05e9\u05de\u05d4"),t.bVm())}function Rt(v,D){1&v&&(t.qex(0),t.nrm(1,"ion-spinner",74),t.bVm())}function At(v,D){1&v&&(t.qex(0),t.nrm(1,"ion-icon",70),t.bVm())}function Nt(v,D){if(1&v){const h=t.RV6();t.j41(0,"button",76),t.bIt("click",function(){t.eBV(h);const i=t.XpG(2).$implicit,l=t.XpG();return t.Njj(l.enrollUser(i))}),t.DNE(1,Pt,2,0,"ng-container",12)(2,Rt,2,0,"ng-container",12)(3,At,2,0,"ng-container",12),t.k0s()}if(2&v){const h=t.XpG(2).$implicit;t.Y8G("disabled",h.isLoading||h.isSuccess)("ngClass",t.l_i(5,Kt,h.isLoading,h.isSuccess)),t.R7$(),t.Y8G("ngIf",!h.isLoading&&!h.isSuccess),t.R7$(),t.Y8G("ngIf",h.isLoading),t.R7$(),t.Y8G("ngIf",h.isSuccess)}}function Yt(v,D){if(1&v&&(t.qex(0),t.DNE(1,Gt,6,12,"button",71)(2,Nt,4,8,"button",72),t.bVm()),2&v){const h=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf",h.booked===h.total_participants),t.R7$(),t.Y8G("ngIf",h.booked<h.total_participants)}}function Ft(v,D){if(1&v){const h=t.RV6();t.j41(0,"div",52)(1,"div",53)(2,"div",54),t.EFF(3),t.nI1(4,"date"),t.k0s(),t.j41(5,"div",55)(6,"ion-icon",56),t.bIt("click",function(){const i=t.eBV(h).$implicit,l=t.XpG();return t.Njj(l.toggleFavorite(i))}),t.k0s(),t.j41(7,"ion-icon",57),t.bIt("click",function(){const i=t.eBV(h).$implicit,l=t.XpG();return t.Njj(l.openMusicModal(i))}),t.k0s()()(),t.j41(8,"div",58)(9,"h3",59),t.EFF(10),t.k0s(),t.j41(11,"div",60)(12,"div",61),t.bIt("mouseenter",function(){const i=t.eBV(h).$implicit,l=t.XpG();return t.Njj(l.showParticipantsPopup(i))})("mouseleave",function(){t.eBV(h);const i=t.XpG();return t.Njj(i.hideParticipantsPopup())}),t.EFF(13),t.DNE(14,te,3,1,"div",62),t.k0s()()(),t.j41(15,"div",63)(16,"div",64)(17,"div",65),t.nrm(18,"div",66),t.k0s()()(),t.j41(19,"div",67),t.DNE(20,ee,4,0,"ng-container",12)(21,Yt,3,2,"ng-container",12),t.k0s()()}if(2&v){const h=D.$implicit,e=t.XpG();t.Y8G("ngClass",t.l_i(17,It,"shalom"===e.selectedFilterAllFav,"shalom"!=e.selectedFilterAllFav)),t.R7$(3),t.SpI(" ",t.i5U(4,14,h.start_time,"HH:mm")," "),t.R7$(3),t.AVh("favorite",h.favorite),t.R7$(4),t.JRh(h.title.name),t.R7$(),t.Y8G("ngClass",e.capacityState(h)),t.R7$(2),t.Lme(" ",h.booked,"/",h.total_participants," "),t.R7$(),t.Y8G("ngIf",e.isPopupVisible&&e.activeAppointment===h),t.R7$(4),t.xc7("width",e.calculateProgress(h)+"%"),t.Y8G("ngStyle",t.eq3(20,kt,"shalom"===e.selectedFilterAllFav?"linear-gradient(90deg, rgb(255, 131, 102) 0%, rgb(255, 48, 0) 100%)":"linear-gradient(-90deg, #59c7cd 0%, #00eaf5 100%)")),t.R7$(2),t.Y8G("ngIf",h.isUserBooked),t.R7$(),t.Y8G("ngIf",!h.isUserBooked)}}let Bt=(()=>{var v;class D{get showSkeleton(){return"shalom"===this.selectedFilterAllFav&&this.isShalomLoading||"all"===this.selectedFilterAllFav&&this.isBenYehudaLoading}constructor(e,i,l,f,M,C,L,G){this.platform=e,this.toastController=i,this.modalCtrl=l,this.http=f,this.authService=M,this.modalCalendar=C,this.profileService=L,this.apptCache=G,this.USE_APPT_CACHE=!0,this.cachedAppointments=[],this.cachedByDate={},this.scheduleItems=[],this.scheduleByDate={},this.customerID="",this.userEmail="",this.userFavLocation="",this.userRole="",this.isTrainer=!1,this.showingParticipants=!1,this.isPopupVisible=!1,this.activeAppointment=null,this.selectedFilterAllFav="all",this.selectedType="",this.availabilityFilter="all",this.showDropdown=!1,this.availableTypes=[],this.appointments=[],this.filteredAppointments=[],this.bookedAppointments=[],this.combinedList=[],this.days=[],this.knownTrainingTypes=["\u05e4\u05d9\u05dc\u05d0\u05d8\u05d9\u05e1","\u05d9\u05d5\u05d2\u05d4","\u05d0\u05d9\u05de\u05d5\u05df \u05db\u05d5\u05d7","Parallel 15","Spinning","TRX","Booty&ABS","All In","HiiT","POWER",""],this.availableTimeslots=[],this.unfilteredList=[],this.PROVIDER_BEN_YEHUDA=169,this.PROVIDER_HAYARKON=643,this.isLoading=!0,this.isStandbyLoading=!1,this.isStandbySuccess=!1,this.isEnrollLoading=!1,this.isEnrollSuccess=!1,this.showToast=!1,this.toastMessage="",this.toastColor="success",this.errorMessage="",this.currentDateRange=null,this.allAvailableDays=[],this.tabLoadingState=!1,this.indicatorPosition=357,this.indicatorWidth=20,this.benYehudaDays=[],this.shalomDays=[],this.benYehudaAppointments=[],this.shalomAppointments=[],this.benYehudaTimeslots=[],this.shalomTimeslots=[],this.benYehudaLoaded=!1,this.shalomLoaded=!1,this.isShalomLoading=!1,this.isBenYehudaLoading=!0,this.previousTab="","trainer"===this.authService.getUserRole()&&(this.isTrainer=!0),this.userId=this.authService.getUserID(),this.userEmail=this.authService.getUserEmail(),this.customerID=this.authService.getCustomerID(),this.userFavLocation=this.authService.getUserFavLocation(),this.authService.fetchPackageCustomerId(this.customerID).subscribe({error:V=>{console.error("Error fetching package id",V)}})}ngAfterViewInit(){setTimeout(()=>{this.updateIndicatorPosition()},100)}ionViewWillEnter(){var e=this;return(0,r.A)(function*(){if(console.log("[TrainingsPage] Auth",e.authService.getUserID(),e.authService.getCustomerID(),e.authService.getUserRole()),"\u05d1\u05df \u05d9\u05d4\u05d5\u05d3\u05d4"===e.userFavLocation||"\u05d4\u05db\u05dc"===e.userFavLocation?e.selectedFilterAllFav="all":"\u05d4\u05d9\u05e8\u05e7\u05d5\u05df"===e.userFavLocation&&(e.selectedFilterAllFav="shalom"),e.USE_APPT_CACHE&&(yield e.loadScheduleFromCacheIfPossible()))return console.log("[TrainingsPage] schedule loaded from cache; skipping network."),void e.filterFavAll(e.selectedFilterAllFav);console.warn("[TrainingsPage] Cache empty or disabled \u2192 fallback legacy load"),yield e.loadInitialData(),e.USE_APPT_CACHE&&e.apptCache.schedule$.subscribe(i=>{null!=i&&i.length&&(e.scheduleItems=i,e.appointments=e.mapScheduleToTrainingCards(i),e.indexScheduleByDate(),e.applyScheduleToUI(),e.filterFavAll(e.selectedFilterAllFav))})})()}loadScheduleFromCacheIfPossible(){var e=this;return(0,r.A)(function*(){try{const i=yield e.apptCache.ensureScheduleLoaded(20);return i&&i.length?(console.log("[TrainingsPage] Loading from cache:",i.length,"items"),e.scheduleItems=i,e.appointments=e.mapScheduleToTrainingCards(i),e.combinedList=[...e.appointments],e.unfilteredList=[...e.appointments],e.indexScheduleByDate(),e.extractAvailableDaysFromCache(),e.applyScheduleToUI(),e.isBenYehudaLoading=!1,e.isShalomLoading=!1,e.isLoading=!1,e.updateFilteredAppointments(),!0):(console.log("[TrainingsPage] Cache is empty"),!1)}catch(i){return console.error("[TrainingsPage] Cache load failed:",i),!1}})()}extractAvailableDaysFromCache(){const e=["\u05d0'","\u05d1'","\u05d2'","\u05d3'","\u05d4'","\u05d5'","\u05e9'"],i=(new Date).toISOString().split("T")[0];let l=null;"all"===this.selectedFilterAllFav?l=this.PROVIDER_BEN_YEHUDA:"shalom"===this.selectedFilterAllFav&&(l=this.PROVIDER_HAYARKON);let f=this.scheduleItems;null!==l&&(f=this.scheduleItems.filter(L=>L.providerId===l));const C=Array.from(new Set(f.map(L=>L.date).filter(L=>L))).map(L=>{const G=new Date(L);return{date:L,day:e[G.getDay()],formattedDate:`${G.getDate()}.${G.getMonth()+1}`}});C.sort((L,G)=>L.date===i?-1:G.date===i?1:new Date(L.date).getTime()-new Date(G.date).getTime()),this.days=C,this.selectedDay=this.days.length>0?this.days[0].date:""}mapScheduleToTrainingCards(e){const i=this.getFavoriteTrainings();return e.map(l=>{var f,M,C;return{id:l.appointmentId,type:"training",appointmentId:l.appointmentId,providerId:l.providerId,start_time:l.startTime,title:{name:l.serviceName},booked:null!==(f=l.booked)&&void 0!==f?f:0,total_participants:null!==(M=l.capacity)&&void 0!==M?M:null!==(C=l.booked)&&void 0!==C?C:0,current_participants:[],isUserBooked:!!l.isUserBooked,isTrainer:!!l.isTrainer,favorite:i.includes(l.appointmentId),songsCount:0}})}isApptFavorite(e){return!1}indexScheduleByDate(){const e={};for(const l of this.scheduleItems){var i;l.date&&(e[i=l.date]||(e[i]=[])).push(l)}for(const l in e)e[l].sort((f,M)=>f.startTime.localeCompare(M.startTime));this.scheduleByDate=e}applyScheduleToUI(){var e;if(null!==(e=this.days)&&void 0!==e&&e.length)for(const i of this.days){const f=this.scheduleByDate[i.date]||[];let M=f;"all"===this.selectedFilterAllFav?M=f.filter(C=>C.providerId===this.PROVIDER_BEN_YEHUDA):"shalom"===this.selectedFilterAllFav&&(M=f.filter(C=>C.providerId===this.PROVIDER_HAYARKON)),i.scheduleItems=M}}ngOnInit(){var e=this;return(0,r.A)(function*(){e.isLoading=!0;try{if("inactive"===e.userRole)return void e.presentToast("\u05dc\u05d0 \u05e0\u05d9\u05ea\u05df \u05dc\u05d8\u05e2\u05d5\u05df \u05d0\u05d9\u05de\u05d5\u05e0\u05d9\u05dd, \u05d4\u05de\u05e9\u05ea\u05de\u05e9 \u05dc\u05d0 \u05e4\u05e2\u05d9\u05dc","danger");if("trial-users"===e.userRole)return void e.presentToast("\u05dc\u05d0 \u05e0\u05d9\u05ea\u05df \u05dc\u05d8\u05e2\u05d5\u05df \u05d0\u05d9\u05de\u05d5\u05e0\u05d9\u05dd, \u05de\u05e9\u05ea\u05de\u05e9 \u05e0\u05d9\u05e1\u05d9\u05d5\u05df","danger");const i=e.authService.getUserFavLocation();e.userFavLocation=i,"\u05d1\u05df \u05d9\u05d4\u05d5\u05d3\u05d4"===e.userFavLocation||"\u05d4\u05db\u05dc"===e.userFavLocation?e.selectedFilterAllFav="all":"\u05d4\u05d9\u05e8\u05e7\u05d5\u05df"===e.userFavLocation&&(e.selectedFilterAllFav="shalom")}catch(i){console.error("Error during initialization:",i),e.presentToast("\u05e9\u05d2\u05d9\u05d0\u05d4 \u05d1\u05de\u05e9\u05d9\u05db\u05ea \u05e0\u05ea\u05d5\u05e0\u05d9\u05dd","danger")}finally{e.isLoading=!1}})()}openTrainerAppointment(e){var i=this;return(0,r.A)(function*(){try{const l=yield i.apptCache.loadParticipants(e.appointmentId);i.presentParticipantsModal(e,l)}catch(l){console.error("Failed to load participants",l)}})()}presentParticipantsModal(e,i){console.log("Participants for appt",e.appointmentId,i)}mapCacheIntoDayModel(){var e;if(null===(e=this.cachedAppointments)||void 0===e||!e.length)return void(this.cachedByDate={});const i={};for(const f of this.cachedAppointments){var l;(i[l=f.date]||(i[l]=[])).push(f)}this.cachedByDate=i}hasTrainerAppts(e){const i=this.cachedByDate[e];return!(!i||!i.some(l=>l.isTrainer))}presentToast(e,i){var l=this;return(0,r.A)(function*(){yield(yield l.toastController.create({message:e,duration:3e3,color:i,position:"bottom"})).present()})()}extractAvailableDays(){const e=["\u05d0'","\u05d1'","\u05d2'","\u05d3'","\u05d4'","\u05d5'","\u05e9'"],i=(new Date).toISOString().split("T")[0],l=this.combinedList.filter(M=>!isNaN(new Date(M.start_time).getTime())).map(M=>new Date(M.start_time).toISOString().split("T")[0]),f=Array.from(new Set(l)).map(M=>{const C=new Date(M);return{date:M,day:e[C.getDay()],formattedDate:`${C.getDate()}.${C.getMonth()+1}`}});f.sort((M,C)=>M.date===i?-1:C.date===i?1:new Date(M.date).getTime()-new Date(C.date).getTime()),"all"===this.selectedFilterAllFav?this.benYehudaDays=f:"shalom"===this.selectedFilterAllFav&&(this.shalomDays=f),this.days="all"===this.selectedFilterAllFav?this.benYehudaDays:this.shalomDays,this.selectedDay=this.days.length>0?this.days[0].date:""}extractAvailableTypes(){const e=new Set(this.filteredAppointments.map(i=>i.title.name));this.availableTypes=Array.from(e)}getAppointmentsForSelectedDay(){return this.combinedList.filter(e=>{const i=W(e.start_time);return i.isValid()&&i.format("YYYY-MM-DD")===this.selectedDay})}loadInitialData(){var e=this;return(0,r.A)(function*(){"all"===e.selectedFilterAllFav?(e.isBenYehudaLoading=!0,setTimeout(()=>{},0)):"shalom"===e.selectedFilterAllFav&&(e.isShalomLoading=!0);try{const l=new Date,f=new Date(l);f.setDate(l.getDate()+20);let M=e.profileService.getSubscriptionExpiryDate(),C=f;if(M){const[G,V,dt]=M.split("/").map(Number);var i=new Date(dt,V-1,G);nt=C,vt=i,pt=l,C=Math.abs(nt-pt)<Math.abs(vt-pt)?nt:vt}e.currentDateRange={start:l,end:C};let L=e.userFavLocation;"\u05d4\u05db\u05dc"==e.userFavLocation&&(L="\u05d1\u05df \u05d9\u05d4\u05d5\u05d3\u05d4"),console.time("fetchTime"),yield e.fetchTrainingsForDateRange(l,C,L),console.timeEnd("fetchTime")}catch(l){console.error("Error loading initial data:",l),yield e.presentToast("\u05e9\u05d2\u05d9\u05d0\u05d4 \u05d1\u05d8\u05e2\u05d9\u05e0\u05ea \u05d0\u05d9\u05de\u05d5\u05e0\u05d9\u05dd","danger")}finally{"all"===e.selectedFilterAllFav?(e.isBenYehudaLoading=!1,setTimeout(()=>{},0)):"shalom"===e.selectedFilterAllFav&&(e.isShalomLoading=!1)}var nt,vt,pt})()}fetchTrainingsForDateRange(e,i,l){var f=this;return(0,r.A)(function*(){if("\u05d1\u05df \u05d9\u05d4\u05d5\u05d3\u05d4"===l&&f.benYehudaLoaded)return f.combinedList=[...f.benYehudaAppointments],f.unfilteredList=[...f.combinedList],void f.updateFilteredAppointments();if("\u05d4\u05d9\u05e8\u05e7\u05d5\u05df"===l&&f.shalomLoaded)return f.combinedList=[...f.shalomAppointments],f.unfilteredList=[...f.combinedList],void f.updateFilteredAppointments();const M=f.authService.getUserID(),C=L=>W(L).format("YYYY-MM-DD");try{const L=C(e),G=C(i);console.log("endDateFormatted:",G);const dt=`https://k-studio.co.il/wp-json/custom-api/v1/get-trainings?startDate=${L}&endDate=${G}&userID=${M}&location=${encodeURIComponent(l)}`,ut=yield(0,bt._)(f.http.get(dt));for(let nt=new Date(e);nt<=i;nt.setDate(nt.getDate()+1)){const vt=C(new Date(nt));f.allAvailableDays.includes(vt)||f.allAvailableDays.push(vt)}yield f.combineTimeslotsAndAppointments(ut),"\u05d1\u05df \u05d9\u05d4\u05d5\u05d3\u05d4"===l?(f.benYehudaAppointments=[...f.combinedList],f.benYehudaLoaded=!0):"\u05d4\u05d9\u05e8\u05e7\u05d5\u05df"===l&&(f.shalomAppointments=[...f.combinedList],f.shalomLoaded=!0)}catch(L){throw console.error("Error fetching trainings:",L),L}})()}combineTimeslotsAndAppointments(e){var i=this;return(0,r.A)(function*(){try{const l=e.filter(G=>"timeslot"===G.type),f=e.filter(G=>"appointment"===G.type),M="all"===i.selectedFilterAllFav;M?(i.benYehudaTimeslots=l,i.benYehudaAppointments=f):(i.shalomTimeslots=l,i.shalomAppointments=f),i.combinedList=[...M?i.benYehudaTimeslots:i.shalomTimeslots,...M?i.benYehudaAppointments:i.shalomAppointments],i.combinedList.sort((G,V)=>new Date(G.start_time).getTime()-new Date(V.start_time).getTime()),i.unfilteredList=[...i.combinedList],i.extractAvailableDays();const C=i.authService.getUserFullName(),L=i.combinedList.map(function(){var G=(0,r.A)(function*(V){V.start_time&&!isNaN(Date.parse(V.start_time))?(V.isStandbyEnrolled=V.booked>=V.total_participants&&void 0!==V.id&&(yield i.checkStandbyEnrollment(i.userEmail,V.id)),Array.isArray(V.current_participants)?V.isUserBooked=V.current_participants.some(dt=>dt===C):(console.warn("current_participants is not an array for training:",V),V.isUserBooked=!1)):console.error("Invalid start_time for training:",V)});return function(V){return G.apply(this,arguments)}}());yield Promise.all(L),i.filteredAppointments=[...i.combinedList],i.updateFilteredAppointments()}catch(l){console.error("Error combining timeslots and appointments:",l)}})()}onDayChange(e){const i=String(e||"");this.selectedDay=i,this.logDayChange(i),this.updateIndicatorPosition(),this.updateFilteredAppointments(),console.log("[DEBUG] Appointments after day change:",this.filteredAppointments.filter(l=>W(l.start_time).format("YYYY-MM-DD")===i).map(l=>({id:l.id,title:l.title.name,time:l.start_time,provider:l.providerId===this.PROVIDER_BEN_YEHUDA?"Ben Yehuda":"Hayarkon"})))}updateIndicatorPosition(){setTimeout(()=>{if(!this.segmentButtons||0===this.segmentButtons.length)return;const e=this.days.findIndex(f=>f.date===this.selectedDay);if(-1!==e){var i,l;const f=null===(i=this.segmentButtons.toArray()[e])||void 0===i?void 0:i.nativeElement;if(f&&null!==(l=this.segmentScroll)&&void 0!==l&&l.nativeElement){const M=f.getBoundingClientRect(),C=this.segmentScroll.nativeElement.getBoundingClientRect();this.indicatorPosition=M.left-C.left+f.offsetWidth/2-this.indicatorWidth/2,this.renderer.setStyle(this.indicator.nativeElement,"transform",`translateX(${this.indicatorPosition}px)`)}}},50)}getIndicatorPosition(){return this.indicatorPosition}logTabChange(e,i=""){console.groupCollapsed(`[DEBUG] Tab changed to ${e} ${i}`),console.log("Current tab:",this.selectedFilterAllFav),console.log("Previous tab:",this.previousTab),console.log("Days count:",this.days.length),console.log("Selected day:",this.selectedDay),console.log("Schedule items count:",this.scheduleItems.length),console.log("Combined list count:",this.combinedList.length),console.log("Filtered appointments count:",this.filteredAppointments.length),console.groupEnd(),this.previousTab=e}logDayChange(e){console.groupCollapsed(`[DEBUG] Day changed to ${e}`),console.log("Current tab:",this.selectedFilterAllFav),console.log("Days:",this.days);const i=this.filteredAppointments.filter(l=>W(l.start_time).format("YYYY-MM-DD")===e);if(console.log("Appointments for this day:",i),i.length>0){const l=i.reduce((f,M)=>{const C=M.providerId===this.PROVIDER_BEN_YEHUDA?"Ben Yehuda":M.providerId===this.PROVIDER_HAYARKON?"Hayarkon":"Other";return f[C]=(f[C]||0)+1,f},{});console.log("Provider distribution:",l)}console.groupEnd()}filterFavAll(e){var i=this;return(0,r.A)(function*(){console.log("event:",e);const l=e.detail.value;if(i.logTabChange(l,`via UI selection (was ${i.selectedFilterAllFav})`),i.selectedFilterAllFav=l,i.combinedList=[],i.filteredAppointments=[],i.days=[],"favorites"===l){const f=i.getFavoriteTrainings();return i.filteredAppointments=i.unfilteredList.filter(M=>f.includes(M.id)),void i.extractAvailableDays()}"all"===l?i.isBenYehudaLoading=!0:"shalom"===l&&(i.isShalomLoading=!0);try{if(i.USE_APPT_CACHE&&i.scheduleItems.length>0){const f="all"===l?i.PROVIDER_BEN_YEHUDA:i.PROVIDER_HAYARKON,M=i.scheduleItems.filter(C=>C.providerId===f);i.combinedList=i.mapScheduleToTrainingCards(M),i.unfilteredList=[...i.combinedList],i.extractAvailableDaysFromCache(),i.updateFilteredAppointments(),console.log("[DEBUG] After filtering - Combined list:",i.combinedList),console.log("[DEBUG] First 3 items providerIds:",i.combinedList.slice(0,3).map(C=>C.providerId))}}finally{"all"===l?i.isBenYehudaLoading=!1:i.isShalomLoading=!1}})()}toggleAvailabilityFilter(){this.availabilityFilter="all"===this.availabilityFilter?"available":"all",this.updateFilteredAppointments()}updateFilteredAppointments(){console.groupCollapsed("[DEBUG] updateFilteredAppointments"),console.log("Current tab:",this.selectedFilterAllFav),console.log("Selected day:",this.selectedDay),console.log("Availability filter:",this.availabilityFilter),console.log("Selected type:",this.selectedType);let e=[...this.unfilteredList];console.log("Initial unfiltered count:",e.length),this.selectedDay&&(e=e.filter(i=>W(i.start_time).format("YYYY-MM-DD")===this.selectedDay),console.log("After day filter:",e.length)),"available"===this.availabilityFilter&&(e=e.filter(i=>i.booked<i.total_participants)),this.selectedType&&(e=e.filter(i=>i.title.name===this.selectedType)),"favorites"===this.selectedFilterAllFav&&(e=e.filter(i=>i.favorite)),e.sort((i,l)=>new Date(i.start_time).getTime()-new Date(l.start_time).getTime()),this.filteredAppointments=[...e],this.extractAvailableTypes(),console.log("Final filtered count:",this.filteredAppointments.length),console.groupEnd()}onFilterChange(){this.updateFilteredAppointments()}onTypeChange(){this.updateFilteredAppointments()}resetTypeFilter(){this.selectedType="",this.updateFilteredAppointments()}removePastFavorites(){const e=new Date,l=this.getFavoriteTrainings().filter(f=>{const M=this.combinedList.find(C=>C.id===f);return M&&new Date(M.start_time)>e});this.saveFavoriteTrainings(l)}closeModal(){document.body.classList.remove("no-scroll"),this.modalCtrl.dismiss()}toggleFavorite(e){e.favorite=!e.favorite;const i=this.getFavoriteTrainings();if(e.favorite)i.includes(e.id)||i.push(e.id);else{const l=i.indexOf(e.id);l>-1&&i.splice(l,1)}this.saveFavoriteTrainings(i),"favorites"===this.selectedFilterAllFav&&this.updateFilteredAppointments()}getFavoriteTrainings(){const e=localStorage.getItem("favoriteTrainings");return e?JSON.parse(e):[]}saveFavoriteTrainings(e){localStorage.setItem("favoriteTrainings",JSON.stringify(e))}toggleFilterDropdown(e){e&&e.stopPropagation(),!this.isAnimating&&(this.showDropdown=!this.showDropdown,this.isAnimating=!0,this.showDropdown?document.body.classList.add("no-scroll"):document.body.classList.remove("no-scroll"))}handleOutsideClick(e){var i;const l=e.target,f=document.querySelector(".filter-dropdown"),M=null===(i=document.querySelector(".filter-icon"))||void 0===i?void 0:i.parentElement,C=document.querySelector(".training-list");this.showDropdown&&f&&M&&!f.contains(l)&&!M.contains(l)&&(null==C||!C.contains(l))&&(this.showDropdown=!1,document.body.classList.remove("no-scroll"))}dropdownAnimationDone(e){"closed"!==e.toState||this.showDropdown?"open"===e.toState&&this.showDropdown&&(this.isAnimating=!1):this.isAnimating=!1}getDropdownState(){return this.showDropdown?"open":"closed"}calculateProgress(e){if(!e.current_participants||!e.total_participants)return 0;const i=e.current_participants.length/e.total_participants*100;return i>100?100:i}capacityRatio(e){var i;const l=null!==(i=null==e?void 0:e.total_participants)&&void 0!==i?i:0;return l>0?e.booked/l:0}capacityState(e){const i=this.capacityRatio(e);return 0===i?"empty":i<.25?"low":i<.75?"medium":i<1?"high":1===i?"full":"over"}showParticipantsPopup(e){var i=this;return(0,r.A)(function*(){var l;if(i.activeAppointment=e,i.isPopupVisible=!0,!(null!==(l=e.current_participants)&&void 0!==l&&l.length||e.participantsLoaded)){e.participantsLoaded=!0;try{const f=yield i.apptCache.loadParticipants(e.appointmentId);e.current_participants=f.map(M=>M.name||M.email||"\u05de\u05e9\u05ea\u05ea\u05e3")}catch(f){console.error("participants load failed",f),e.current_participants=[]}}})()}hideParticipantsPopup(){this.activeAppointment=null,this.isPopupVisible=!1}addToStandbyList(e,i,l){e.isStandbyLoading=!0,e.isStandbySuccess=!1;const M={appointment_id:null==e?void 0:e.id,customer_id:i,email:l};console.log("data",M),this.http.post("https://k-studio.co.il/wp-json/standby-list/v1/add",M).subscribe(()=>{e.isStandbyLoading=!1,e.isStandbySuccess=!0,this.apptCache.invalidate().then(()=>this.apptCache.ensureLoaded(!0)),this.apptCache.invalidateSchedule().then(()=>this.apptCache.ensureScheduleLoaded(20,!0))},C=>{console.error("Error adding user to standby list",C),e.isStandbyLoading=!1,this.presentToast("\u05e9\u05d2\u05d9\u05d0\u05d4","danger")})}checkStandbyEnrollment(e,i){const f=(new K.Nl).set("email",e).set("trainingId",i.toString());return(0,bt._)(this.http.get("https://k-studio.co.il/wp-json/standby-list/v1/check",{params:f})).then(M=>M.isEnrolled).catch(M=>(console.error("Error checking standby enrollment",M),!1))}enrollUser(e){e.isLoading=!0,e.isSuccess=!1,e.isError=!1;let i=e.serviceID;const f=e.start_time.slice(0,16);let M=e.providerId,C=this.authService.getCustomerID(),L=this.authService.getPackageCustomerId();const dt={type:"appointment",serviceId:i,providerId:M,locationId:null,notifyParticipants:0,bookings:[{customerId:C,status:"approved",duration:3600,persons:1,extras:[],customFields:{},utcOffset:-(new Date).getTimezoneOffset(),packageCustomerService:{packageCustomer:{id:L}}}],bookingStart:f,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};this.platform.ready().then(()=>{const ut=JSON.stringify(dt);this.http.post("https://k-studio.co.il/wp-json/wn/v1/enrollTraining",ut,{headers:{"Content-Type":"application/json"}}).subscribe(nt=>{var vt,pt;if(console.log("Response:",nt),null===nt.message||null===nt.data)return this.presentToast("\u05e9\u05d2\u05d9\u05d0\u05d4: \u05dc\u05d0 \u05e0\u05de\u05e6\u05d0\u05d4 \u05d7\u05d1\u05d9\u05dc\u05d4 \u05d6\u05de\u05d9\u05e0\u05d4","danger"),e.isError=!0,void(e.isLoading=!1);if(null!==(vt=nt.data)&&void 0!==vt&&vt.timeSlotUnavailable)this.presentToast(nt.message||"The time slot is unavailable","danger");else if(null!==(pt=nt.data)&&void 0!==pt&&pt.customerAlreadyBooked)this.presentToast(nt.message||"You have already booked this training","success");else if(nt.message){e.isSuccess=!0,e.current_participants||(e.current_participants=[]),e.booked+=1;const ne=`${this.authService.getUserFullName()}`;e.current_participants.push(ne),e.isUserBooked=!0,this.apptCache.invalidate().then(()=>this.apptCache.ensureLoaded(!0)),this.apptCache.invalidateSchedule().then(()=>this.apptCache.ensureScheduleLoaded(20,!0))}else e.isSuccess=!0;e.isLoading=!1,setTimeout(()=>{e.isSuccess=!1},2e3)},nt=>{console.error("Enrollment failed",JSON.stringify(nt)),e.isLoading=!1,nt.error&&nt.error.includes('"packageCustomerId" is required for booking')?this.presentToast("\u05dc\u05d0 \u05e0\u05de\u05e6\u05d0\u05d4 \u05d7\u05d1\u05d9\u05dc\u05d4 \u05d6\u05de\u05d9\u05e0\u05d4","danger"):this.presentToast("\u05e9\u05d2\u05d9\u05d0\u05d4","danger"),e.isError=!0})})}openCalendarPopup(){var e=this;return(0,r.A)(function*(){let i="";"all"===e.selectedFilterAllFav?i="main":"shalom"===e.selectedFilterAllFav&&(i="second"),yield(yield e.modalCalendar.create({component:S,componentProps:{branch:i}})).present()})()}getWeeklyTrainings(){return[]}openMusicModal(e){var i=this;return(0,r.A)(function*(){const l=yield i.modalCtrl.create({component:Mt,componentProps:{training:e}});return l.onDidDismiss().then(f=>{}),yield l.present()})()}}return(v=D).\u0275fac=function(e){return new(e||v)(t.rXU(ft.OD),t.rXU(A.K_),t.rXU(A.W3),t.rXU(K.Qq),t.rXU(j.u),t.rXU(A.W3),t.rXU(lt.p),t.rXU(ot.w))},v.\u0275cmp=t.VBU({type:v,selectors:[["app-trainings"]],viewQuery:function(e,i){if(1&e&&(t.GBs(mt,5),t.GBs($,5),t.GBs(N,5),t.GBs(it,5)),2&e){let l;t.mGM(l=t.lsd())&&(i.popup=l.first),t.mGM(l=t.lsd())&&(i.segmentScroll=l.first),t.mGM(l=t.lsd())&&(i.indicator=l.first),t.mGM(l=t.lsd())&&(i.segmentButtons=l)}},hostBindings:function(e,i){1&e&&t.bIt("click",function(f){return i.handleOutsideClick(f)},!1,t.EBC)},decls:15,vars:6,consts:[["popup",""],["segmentScroll",""],["segmentButton",""],[1,"popup-modal-trainings"],[1,"drag-handle"],[1,"content-container"],[1,"sticky-header"],[1,"header-tabs"],["mode","md",1,"segment-tab",3,"ngModelChange","ionChange","ngModel"],["value","all","class","header-tab",4,"ngIf"],["value","shalom","class","header-tab segment-button-checked-shalom",4,"ngIf"],["value","favorites",1,"header-tab","segment-button-checked-fav"],[4,"ngIf"],["class","custom-style-ion-list",4,"ngIf"],["class","card",3,"ngClass",4,"ngFor","ngForOf"],["value","all",1,"header-tab"],["value","shalom",1,"header-tab","segment-button-checked-shalom"],[1,"segment-container"],[1,"segment-scroll"],[4,"ngFor","ngForOf"],["class","filter-header",4,"ngIf"],["class","filter-dropdown",4,"ngIf"],[1,"segment-button",3,"click","ngStyle"],[1,"segment-label"],[1,"filter-header"],[1,"icon-button",3,"click"],[1,"filter-icon"],["name","filter-outline",1,"filter-icon"],[1,"icon-button","calendar-button"],[1,"calendar-icon"],["name","calendar-outline","class","calendar-icon",3,"click",4,"ngIf"],["name","calendar-outline",1,"calendar-icon",3,"click"],[1,"filter-dropdown"],[2,"text-indent","8px"],["interface","popover","placeholder","\u05d1\u05d7\u05e8 \u05e1\u05d5\u05d2 \u05d0\u05d9\u05de\u05d5\u05df",3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["color","danger","fill","clear",3,"click",4,"ngIf"],[3,"ngModelChange","ionChange","ngModel"],["value","all",1,"filter-button-segment"],["value","available",1,"filter-button-segment"],[3,"value"],["color","danger","fill","clear",3,"click"],["name","close-circle"],[1,"custom-style-ion-list"],[2,"width","80px",3,"animated"],["lines","none","class","skeleton-item",4,"ngFor","ngForOf"],["lines","none",1,"skeleton-item"],["slot","start"],[3,"animated"],[2,"width","80%",3,"animated"],[2,"width","60%",3,"animated"],[2,"width","30%",3,"animated"],[1,"card",3,"ngClass"],[1,"card-header"],[1,"time-date"],[1,"icons-header"],["name","heart-outline",3,"click"],["name","play-circle-outline",3,"click"],[1,"training-title-and-participants"],[1,"training-title"],[1,"participants-container",3,"ngClass"],[1,"participants",3,"mouseenter","mouseleave"],["class","participant-popup",4,"ngIf"],[1,"card-content"],[1,"progress-bar-container"],[1,"progress-bar"],[1,"progress",3,"ngStyle"],[1,"card-footer"],[1,"participant-popup"],["disabled","",1,"btn","btn-enrolled","action-button"],["name","checkmark-circle",1,"success-icon"],["class","btn btn-primary action-button",3,"ngClass","disabled","click",4,"ngIf"],["class","btn btn-primary action-button",3,"disabled","ngClass","click",4,"ngIf"],[1,"btn","btn-primary","action-button",3,"click","ngClass","disabled"],["name","crescent"],["name","close-circle",1,"error-icon"],[1,"btn","btn-primary","action-button",3,"click","disabled","ngClass"]],template:function(e,i){if(1&e){const l=t.RV6();t.j41(0,"ion-content",3,0),t.nrm(2,"div",4),t.j41(3,"div",5)(4,"div",6)(5,"div",7)(6,"ion-segment",8),t.mxI("ngModelChange",function(M){return t.eBV(l),t.DH7(i.selectedFilterAllFav,M)||(i.selectedFilterAllFav=M),t.Njj(M)}),t.bIt("ionChange",function(M){return t.eBV(l),t.Njj(i.filterFavAll(M))}),t.DNE(7,Ot,3,0,"ion-segment-button",9)(8,Et,3,0,"ion-segment-button",10),t.j41(9,"ion-segment-button",11)(10,"ion-label"),t.EFF(11,"\u05de\u05d5\u05e2\u05d3\u05e4\u05d9\u05dd"),t.k0s()()()(),t.DNE(12,Jt,7,3,"div",12)(13,Wt,4,3,"ion-list",13)(14,Ft,22,22,"div",14),t.k0s()()()}2&e&&(t.R7$(6),t.R50("ngModel",i.selectedFilterAllFav),t.R7$(),t.Y8G("ngIf","\u05d1\u05df \u05d9\u05d4\u05d5\u05d3\u05d4"===i.userFavLocation||"\u05d4\u05db\u05dc"===i.userFavLocation),t.R7$(),t.Y8G("ngIf","\u05d4\u05d9\u05e8\u05e7\u05d5\u05df"===i.userFavLocation||"\u05d4\u05db\u05dc"===i.userFavLocation),t.R7$(4),t.Y8G("ngIf",!i.showSkeleton),t.R7$(),t.Y8G("ngIf",i.showSkeleton),t.R7$(),t.Y8G("ngForOf",i.filteredAppointments))},dependencies:[O.YU,O.Sq,O.bT,O.B3,E.BC,E.vS,A.Jm,A.W9,A.iq,A.uz,A.he,A.nf,A.AF,A.Gp,A.eP,A.Nm,A.Ip,A.ds,A.w2,A.Zx,A.Je,O.vh],styles:['@charset "UTF-8";.sticky-header[_ngcontent-%COMP%]{position:sticky;top:0;z-index:100;background-color:#f8f9fa}.scrollable-list[_ngcontent-%COMP%]{height:calc(100vh - 130px);overflow-y:auto}.filter-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;position:relative;margin-top:20px;margin-bottom:20px}.icon-button[_ngcontent-%COMP%]{position:relative;width:40px;height:40px;border-radius:50%;background-color:#fff;border:1px solid rgba(0,0,0,.1);box-shadow:0 2px 4px #00000014;display:flex;justify-content:center;align-items:center;cursor:pointer;transition:all .2s ease;margin-right:12px}.icon-button[_ngcontent-%COMP%]:hover{box-shadow:0 2px 8px #00000026}.training-title-and-participants[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px}.calendar-button[_ngcontent-%COMP%]{margin-left:16px}.calendar-icon[_ngcontent-%COMP%], .filter-icon[_ngcontent-%COMP%]{position:static;font-size:18px;transform:none;color:#222}.filter-controls[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 0}.training-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:15px;box-shadow:0 4px 12px #0000001a;padding:15px;margin-bottom:20px;width:100%;box-sizing:border-box}.training-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.favorite-icon[_ngcontent-%COMP%]{font-size:24px;color:#5a5a5a}.training-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.4em;font-weight:700;margin-top:-30px;color:#333;font-family:Alef}.training-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9em;color:#666;margin-top:-20px;font-family:Alef}.progress-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:10px}ion-progress-bar[_ngcontent-%COMP%]{--progress-background: #E0E0E0;--background: #9B59B6;border-radius:10px;height:10px;flex-grow:1;margin-left:10px}ion-label[_ngcontent-%COMP%]{font-size:2em;color:#333}ion-button[_ngcontent-%COMP%]{font-weight:700;--border-radius: 25px}.scroll-container[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:none}ion-segment.days-tabs[_ngcontent-%COMP%]{border-bottom:1px solid grey}.filter-segment[_ngcontent-%COMP%]{color:red}ion-segment-button[_ngcontent-%COMP%]{--color-checked: #000}ion-segment-button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:1em;font-weight:700;font-family:Alef}ion-segment-button[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:1em;color:#666;font-weight:700;font-family:Alef}ion-item[_ngcontent-%COMP%]{--inner-padding-end: 0;--inner-padding-start: 0;--padding-start: 0;--padding-end: 0;padding:0}.header-tab[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;padding:0;border:none;box-shadow:none;padding:none;--indicator-color: transparent}.header-tab[_ngcontent-%COMP%]   segment-tab[_ngcontent-%COMP%]   .tab-container[_ngcontent-%COMP%]{display:flex;width:100%}.header-tab[_ngcontent-%COMP%]   segment-tab[_ngcontent-%COMP%]   .header-tab[_ngcontent-%COMP%]{transition:all .3s ease}.header-tab[_ngcontent-%COMP%]   segment-tab[_ngcontent-%COMP%]   .header-tab.dragging-mode[_ngcontent-%COMP%]{cursor:move;opacity:.7;transform:scale(1.05)}.header-tab[_ngcontent-%COMP%]   segment-tab[_ngcontent-%COMP%]   .header-tab[_ngcontent-%COMP%]   .hide-tab-btn[_ngcontent-%COMP%]{margin-left:10px;color:red;cursor:pointer;opacity:.7;transition:opacity .2s}.header-tab[_ngcontent-%COMP%]   segment-tab[_ngcontent-%COMP%]   .header-tab[_ngcontent-%COMP%]   .hide-tab-btn[_ngcontent-%COMP%]:hover{opacity:1}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.3;background-color:#f0f0f0}.header-tabs[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-bottom:10px;width:100%;padding:0 16;border-radius:12px;border:none;box-shadow:0 2px 8px #00000014;position:relative;background:#fff}.custom-tabs[_ngcontent-%COMP%]{position:relative;--background-activated: transparent;--background-focused: transparent;--background: transparent;font-size:1em;--color-checked: #333;--color: #ff0000;padding-bottom:10px;width:90%;margin-left:10px;--indicator-color: transparent}.segment-button-checked[_ngcontent-%COMP%]{position:relative;transition:all .3s ease;border-radius:12px;--indicator-color: transparent;color:#000}.segment-button-checked[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:50%;transform:translate(-50%);width:80%;height:3px;background:#59c7cd;transition:all .3s ease;border-radius:2px}.custom-underline-default.segment-button-checked[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:50%;transform:translate(-50%);width:80%;height:4px;background:linear-gradient(-90deg,#59c7cd,#4d4d4d);transition:all .3s ease}.scroll-container[_ngcontent-%COMP%]{overflow-x:auto;-ms-overflow-style:none;scrollbar-width:none}.scroll-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.custom-underline-shalom.segment-button-checked[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:50%;transform:translate(-50%);width:80%;height:4px;background:#ff8366;border-radius:12px;transition:all .3s ease}.custom-underline-favorites.segment-button-checked[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:50%;transform:translate(-50%);width:80%;height:4px;background:#373737;border-radius:12px;transition:all .3s ease}.segment-button-checked-shalom[_ngcontent-%COMP%]:after{background:#ff8366}.filter-button-segment[_ngcontent-%COMP%]:after{background:#575757}.segment-button-checked-fav[_ngcontent-%COMP%]:after{background:#373737}.clear-filter-icon[_ngcontent-%COMP%]{font-size:24px;color:#e74c3c;margin-left:10px;cursor:pointer}.filter-dropdown[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:15px;background-color:#fff;border-radius:15px;box-shadow:0 4px 12px #0000001a;padding:15px;width:100%}.filter-dropdown.ng-animating[_ngcontent-%COMP%]{pointer-events:none}ion-select[_ngcontent-%COMP%]{--placeholder-color: #999;--color: #333;--background: #fff;--border-radius: 10px;--box-shadow: 0 4px 12px rgba(0, 0, 0, .1)}.drag-handle[_ngcontent-%COMP%]{width:10px;height:1px;background-color:transparent;border-radius:2.5px;margin:0 auto 10px}.content-container[_ngcontent-%COMP%]{padding:15px;justify-content:center;background-color:#f8f9fa}ion-content[_ngcontent-%COMP%]{--background: #f8f9fa}ion-tab-bar[_ngcontent-%COMP%]{--background: yellow;--color-selected: #3498db;--color: #666}ion-tab-button[_ngcontent-%COMP%]{--color-selected: #666;--color: #666}.card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:20px;margin-bottom:16px;box-shadow:0 4px 20px #00000014;border:1px solid #f0f0f0;transition:all .3s ease;position:relative;overflow:hidden}.card[_ngcontent-%COMP%]:before{background:#59c7cd;content:"";position:absolute;left:0;right:0;top:0;height:4px;border-top-right-radius:20px;border-top-left-radius:20px}.card--shalom[_ngcontent-%COMP%]:before{background:#ff8366}.card--other[_ngcontent-%COMP%]:before{background:#59c7cd}.card--no-bar[_ngcontent-%COMP%]:before{content:none}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:10px}.btn[_ngcontent-%COMP%]{flex:1;padding:12px 16px;border:none;border-radius:12px;font-size:14px;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:8px}.btn-secondary[_ngcontent-%COMP%]{background:#f8f9fa;color:#666;border:1px solid #dee2e6}.btn-enrolled[_ngcontent-%COMP%]{background:#4cb050;color:#fff;border:1px solid #dee2e6}.btn-primary[_ngcontent-%COMP%]{background:#2f2f2f;color:#fff}.training-title[_ngcontent-%COMP%]{font-size:1.4em;margin-bottom:-5px;margin-top:5px;color:#333;font-family:Alef;margin-left:auto}.card-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;cursor:pointer;margin-left:10px}.card-header[_ngcontent-%COMP%]   ion-icon.favorite[_ngcontent-%COMP%]{color:red}.time-date[_ngcontent-%COMP%]{color:gray;background:linear-gradient(90deg,#929292,#838383);color:#fff;padding:8px 16px;border-radius:20px;font-size:14px;line-height:15px;display:inline}.segment-button[_ngcontent-%COMP%]:not(.segment-button-checked):after{height:0}.progress-bar[_ngcontent-%COMP%]{background-color:#e0e0e0;border-radius:8px;height:6px}.progress-default[_ngcontent-%COMP%]{background-color:#59c7cd}.progress-shalom[_ngcontent-%COMP%]{background-color:#ff8366}.progress-bar[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{height:6px;border-radius:8px;background-color:#59c7cd}.participants[_ngcontent-%COMP%]{font-size:12px;display:flex;align-items:center}.participants[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:4px}.card-footer[_ngcontent-%COMP%]{margin-top:10px;display:flex}.action-button[_ngcontent-%COMP%]{flex:1;padding:12px 16px;border:none;border-radius:12px;font-size:14px;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:8px}.btn.loading[_ngcontent-%COMP%]{background-color:#f0f0f0;cursor:not-allowed}.btn.success[_ngcontent-%COMP%]{background-color:#4caf50}.action-button.loading[_ngcontent-%COMP%]{flex:1;padding:12px 16px;border:none;border-radius:12px;font-size:14px;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:8px;background-color:#f0f0f0;cursor:not-allowed}.action-button.success[_ngcontent-%COMP%]{background-color:#4caf50}.success-icon[_ngcontent-%COMP%]{color:#fff;font-size:14px}ion-spinner[_ngcontent-%COMP%]{height:15px;width:15px}.action-button.full[_ngcontent-%COMP%]{background-color:#757575}.enrolled-button[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;cursor:not-allowed}.participants-container[_ngcontent-%COMP%]{background:#00000014;color:inherit;padding:4px 12px;border-radius:12px;font-size:12px}.participants-container.empty[_ngcontent-%COMP%]{background:#00000014;color:inherit}.participants-container.low[_ngcontent-%COMP%]{background:#00c85333;color:#0e7a3b}.participants-container.medium[_ngcontent-%COMP%]{background:#ffab0040;color:#b26a00}.participants-container.high[_ngcontent-%COMP%]{background:#ff836659;color:#d85635}.participants-container.full[_ngcontent-%COMP%]{background:#ff300073;color:#fff}.participants-container.over[_ngcontent-%COMP%]{background:repeating-linear-gradient(135deg,#ff3000 0,#ff3000 8px,#000 8px,#000 16px);color:#fff}.participant-popup[_ngcontent-%COMP%]{position:absolute;top:-10px;left:60px;background-color:#fff;border:none;padding:12px;box-shadow:0 8px 16px #00000026;width:180px;z-index:10;border-radius:12px;max-height:200px;overflow-y:auto;transition:opacity .3s ease,transform .3s ease;opacity:0;transform:translateY(-10px)}.participant-popup[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;font-size:14px}.custom-style-ion-list[_ngcontent-%COMP%], .item-native[_ngcontent-%COMP%]{background:#f8f9fa}.skeleton-item[_ngcontent-%COMP%]{background:#f8f9fa;--background: #f8f9fa}.participant-popup[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.participant-popup[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:12px;margin-bottom:5px}.participants[_ngcontent-%COMP%]{cursor:pointer;position:relative;justify-content:center}.participants[_ngcontent-%COMP%]:hover{text-decoration:underline}.participants[_ngcontent-%COMP%]:hover   .participant-popup[_ngcontent-%COMP%]{opacity:1;transform:translateY(0)}.action-button.standby-enrolled[_ngcontent-%COMP%]{background:#f8f9fa;color:#666;border:1px solid #dee2e6;cursor:not-allowed}.action-button.error[_ngcontent-%COMP%]{background-color:#ff4d4d;color:#fff}.action-button[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%]{font-size:14px;color:#fff}.song-count-badge[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;font-size:.7rem}.segment-container[_ngcontent-%COMP%]{width:100%;overflow:hidden;position:relative;display:flex;justify-content:center;gap:8px;margin:16px 0;padding:16px;background:#fff;border-radius:12px;box-shadow:0 2px 8px #00000014}.segment-scroll[_ngcontent-%COMP%]{display:flex;overflow-x:auto;gap:8px;position:relative;font-family:Alef}.segment-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.segment-button[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;min-width:-moz-fit-content;min-width:fit-content;background:#f8f9fa;border-radius:8px;cursor:pointer;transition:all .2s ease;padding:8px 12px;text-align:center}.segment-button.active[_ngcontent-%COMP%]{color:#fff;text-align:center;border-radius:8px}.segment-button.active[_ngcontent-%COMP%]   .segment-label[_ngcontent-%COMP%]{font-size:16px}.segment-button[_ngcontent-%COMP%]:not(.active){color:#999}.segment-button[_ngcontent-%COMP%]:not(.active):hover{color:#666}.segment-icon[_ngcontent-%COMP%]{font-size:24px;margin-bottom:8px}.segment-label[_ngcontent-%COMP%]{font-size:16px;font-weight:500;line-height:20px}.segment-indicator[_ngcontent-%COMP%]{position:absolute;bottom:-2px;left:-3.3%;height:4px;width:48px;background-color:#000;transition:transform .3s ease}'],data:{animation:[(0,T.hZ)("buttonState",[(0,T.wk)("open",(0,T.iF)({transform:"rotate(180deg)"})),(0,T.wk)("closed",(0,T.iF)({transform:"rotate(0deg)"})),(0,T.kY)("closed <=> open",(0,T.i0)("200ms ease-in-out"))]),(0,T.hZ)("dropdownState",[(0,T.wk)("open",(0,T.iF)({opacity:1,transform:"translateY(0)",height:"*"})),(0,T.wk)("closed",(0,T.iF)({opacity:0,transform:"translateY(-10px)",height:"0"})),(0,T.kY)("closed => open",(0,T.i0)("200ms ease-out")),(0,T.kY)("open => closed",(0,T.i0)("200ms ease-in"))])]}}),D})()},9431:(Ct,ht,k)=>{k.d(ht,{B:()=>at});var r=k(8359);class T extends r.yU{constructor(S,z){super()}schedule(S,z=0){return this}}const K={setInterval(J,S,...z){const{delegate:j}=K;return null!=j&&j.setInterval?j.setInterval(J,S,...z):setInterval(J,S,...z)},clearInterval(J){const{delegate:S}=K;return((null==S?void 0:S.clearInterval)||clearInterval)(J)},delegate:void 0};var W=k(7908),t=k(6129);class A{constructor(S,z=A.now){this.schedulerActionCtor=S,this.now=z}schedule(S,z=0,j){return new this.schedulerActionCtor(this,S).schedule(j,z)}}A.now=t.U.now;const O=new class et extends A{constructor(S,z=A.now){super(S,z),this.actions=[],this._active=!1}flush(S){const{actions:z}=this;if(this._active)return void z.push(S);let j;this._active=!0;do{if(j=S.execute(S.state,S.delay))break}while(S=z.shift());if(this._active=!1,j){for(;S=z.shift();)S.unsubscribe();throw j}}}(class bt extends T{constructor(S,z){super(S,z),this.scheduler=S,this.work=z,this.pending=!1}schedule(S,z=0){var j;if(this.closed)return this;this.state=S;const E=this.id,H=this.scheduler;return null!=E&&(this.id=this.recycleAsyncId(H,E,z)),this.pending=!0,this.delay=z,this.id=null!==(j=this.id)&&void 0!==j?j:this.requestAsyncId(H,this.id,z),this}requestAsyncId(S,z,j=0){return K.setInterval(S.flush.bind(S,this),j)}recycleAsyncId(S,z,j=0){if(null!=j&&this.delay===j&&!1===this.pending)return z;null!=z&&K.clearInterval(z)}execute(S,z){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const j=this._execute(S,z);if(j)return j;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(S,z){let E,j=!1;try{this.work(S)}catch(H){j=!0,E=H||new Error("Scheduled action threw falsy error")}if(j)return this.unsubscribe(),E}unsubscribe(){if(!this.closed){const{id:S,scheduler:z}=this,{actions:j}=z;this.work=this.state=this.scheduler=null,this.pending=!1,(0,W.o)(j,this),null!=S&&(this.id=this.recycleAsyncId(z,S,null)),this.delay=null,super.unsubscribe()}}});var st=k(9974),Q=k(4360);function at(J,S=O){return(0,st.N)((z,j)=>{let E=null,H=null,R=null;const X=()=>{if(E){E.unsubscribe(),E=null;const w=H;H=null,j.next(w)}};function Y(){const w=R+J,P=S.now();if(P<w)return E=this.schedule(void 0,w-P),void j.add(E);X()}z.subscribe((0,Q._)(j,w=>{H=w,R=S.now(),E||(E=S.schedule(Y,J),j.add(E))},()=>{X(),j.complete()},void 0,()=>{H=E=null}))})}},6129:(Ct,ht,k)=>{k.d(ht,{U:()=>r});const r={now:()=>(r.delegate||Date).now(),delegate:void 0}},5262:(Ct,ht,k)=>{k.d(ht,{Bu:()=>Ht,Q_:()=>Z,_G:()=>M,w6:()=>C});var r=k(177),T=k(3953),K=k(6860),W=k(1413),bt=k(8359),et=(k(4402),k(7673),k(7336)),O=k(8141),rt=k(9431),st=k(5964),Q=k(6354),at=k(6697),S=k(4085),z=k(4572),j=k(8793),E=k(1985),R=k(9172),X=k(6977);const w=new Set;let P,q=(()=>{var _;class a{constructor(m,y){this._platform=m,this._nonce=y,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):xt}matchMedia(m){return(this._platform.WEBKIT||this._platform.BLINK)&&function tt(_,a){if(!w.has(_))try{P||(P=document.createElement("style"),a&&P.setAttribute("nonce",a),P.setAttribute("type","text/css"),document.head.appendChild(P)),P.sheet&&(P.sheet.insertRule(`@media ${_} {body{ }}`,0),w.add(_))}catch(d){console.error(d)}}(m,this._nonce),this._matchMedia(m)}}return(_=a).\u0275fac=function(m){return new(m||_)(T.KVO(K.OD),T.KVO(T.BIS,8))},_.\u0275prov=T.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),a})();function xt(_){return{matches:"all"===_||""===_,media:_,addListener:()=>{},removeListener:()=>{}}}let yt=(()=>{var _;class a{constructor(m,y){this._mediaMatcher=m,this._zone=y,this._queries=new Map,this._destroySubject=new W.B}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(m){return Mt((0,S.FG)(m)).some(I=>this._registerQuery(I).mql.matches)}observe(m){const I=Mt((0,S.FG)(m)).map(U=>this._registerQuery(U).observable);let B=(0,z.z)(I);return B=(0,j.x)(B.pipe((0,at.s)(1)),B.pipe(function H(_){return(0,st.p)((a,d)=>_<=d)}(1),(0,rt.B)(0))),B.pipe((0,Q.T)(U=>{const ct={matches:!1,breakpoints:{}};return U.forEach(({matches:Tt,query:Zt})=>{ct.matches=ct.matches||Tt,ct.breakpoints[Zt]=Tt}),ct}))}_registerQuery(m){if(this._queries.has(m))return this._queries.get(m);const y=this._mediaMatcher.matchMedia(m),B={observable:new E.c(U=>{const ct=Tt=>this._zone.run(()=>U.next(Tt));return y.addListener(ct),()=>{y.removeListener(ct)}}).pipe((0,R.Z)(y),(0,Q.T)(({matches:U})=>({query:m,matches:U})),(0,X.Q)(this._destroySubject)),mql:y};return this._queries.set(m,B),B}}return(_=a).\u0275fac=function(m){return new(m||_)(T.KVO(q),T.KVO(T.SKi))},_.\u0275prov=T.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),a})();function Mt(_){return _.map(a=>a.split(",")).reduce((a,d)=>a.concat(d)).map(a=>a.trim())}class Et{constructor(a,d){this._letterKeyStream=new W.B,this._items=[],this._selectedItemIndex=-1,this._pressedLetters=[],this._selectedItem=new W.B,this.selectedItem=this._selectedItem;const m="number"==typeof(null==d?void 0:d.debounceInterval)?d.debounceInterval:200;null!=d&&d.skipPredicate&&(this._skipPredicateFn=d.skipPredicate),this.setItems(a),this._setupKeyHandler(m)}destroy(){this._pressedLetters=[],this._letterKeyStream.complete(),this._selectedItem.complete()}setCurrentSelectedItemIndex(a){this._selectedItemIndex=a}setItems(a){this._items=a}handleKey(a){const d=a.keyCode;a.key&&1===a.key.length?this._letterKeyStream.next(a.key.toLocaleUpperCase()):(d>=et.A&&d<=et.Z||d>=et.f2&&d<=et.bn)&&this._letterKeyStream.next(String.fromCharCode(d))}isTyping(){return this._pressedLetters.length>0}reset(){this._pressedLetters=[]}_setupKeyHandler(a){this._letterKeyStream.pipe((0,O.M)(d=>this._pressedLetters.push(d)),(0,rt.B)(a),(0,st.p)(()=>this._pressedLetters.length>0),(0,Q.T)(()=>this._pressedLetters.join("").toLocaleUpperCase())).subscribe(d=>{for(let I=1;I<this._items.length+1;I++){var m,y;const U=this._items[(this._selectedItemIndex+I)%this._items.length];if((null===(m=this._skipPredicateFn)||void 0===m||!m.call(this,U))&&0===(null===(y=U.getLabel)||void 0===y?void 0:y.call(U).toLocaleUpperCase().trim().indexOf(d))){this._selectedItem.next(U);break}}this._pressedLetters=[]})}}class $t{constructor(a,d){this._items=a,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._typeaheadSubscription=bt.yU.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._pageUpAndDown={enabled:!1,delta:10},this._skipPredicateFn=m=>m.disabled,this.tabOut=new W.B,this.change=new W.B,a instanceof T.rOR?this._itemChangesSubscription=a.changes.subscribe(m=>this._itemsChanged(m.toArray())):(0,T.Hps)(a)&&(this._effectRef=(0,T.QZP)(()=>this._itemsChanged(a()),{injector:d}))}skipPredicate(a){return this._skipPredicateFn=a,this}withWrap(a=!0){return this._wrap=a,this}withVerticalOrientation(a=!0){return this._vertical=a,this}withHorizontalOrientation(a){return this._horizontal=a,this}withAllowedModifierKeys(a){return this._allowedModifierKeys=a,this}withTypeAhead(a=200){this._typeaheadSubscription.unsubscribe();const d=this._getItemsArray();return this._typeahead=new Et(d,{debounceInterval:"number"==typeof a?a:void 0,skipPredicate:m=>this._skipPredicateFn(m)}),this._typeaheadSubscription=this._typeahead.selectedItem.subscribe(m=>{this.setActiveItem(m)}),this}cancelTypeahead(){var a;return null===(a=this._typeahead)||void 0===a||a.reset(),this}withHomeAndEnd(a=!0){return this._homeAndEnd=a,this}withPageUpDown(a=!0,d=10){return this._pageUpAndDown={enabled:a,delta:d},this}setActiveItem(a){const d=this._activeItem;this.updateActiveItem(a),this._activeItem!==d&&this.change.next(this._activeItemIndex)}onKeydown(a){var d;const m=a.keyCode,I=["altKey","ctrlKey","metaKey","shiftKey"].every(U=>!a[U]||this._allowedModifierKeys.indexOf(U)>-1);switch(m){case et.wn:return void this.tabOut.next();case et.n6:if(this._vertical&&I){this.setNextItemActive();break}return;case et.i7:if(this._vertical&&I){this.setPreviousItemActive();break}return;case et.LE:if(this._horizontal&&I){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case et.UQ:if(this._horizontal&&I){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case et.yZ:if(this._homeAndEnd&&I){this.setFirstItemActive();break}return;case et.Kp:if(this._homeAndEnd&&I){this.setLastItemActive();break}return;case et.w_:if(this._pageUpAndDown.enabled&&I){const U=this._activeItemIndex-this._pageUpAndDown.delta;this._setActiveItemByIndex(U>0?U:0,1);break}return;case et.dB:if(this._pageUpAndDown.enabled&&I){const U=this._activeItemIndex+this._pageUpAndDown.delta,ct=this._getItemsArray().length;this._setActiveItemByIndex(U<ct?U:ct-1,-1);break}return;default:var B;return void((I||(0,et.rp)(a,"shiftKey"))&&(null===(B=this._typeahead)||void 0===B||B.handleKey(a)))}null===(d=this._typeahead)||void 0===d||d.reset(),a.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return!!this._typeahead&&this._typeahead.isTyping()}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._getItemsArray().length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(a){var d;const m=this._getItemsArray(),y="number"==typeof a?a:m.indexOf(a),I=m[y];this._activeItem=null==I?null:I,this._activeItemIndex=y,null===(d=this._typeahead)||void 0===d||d.setCurrentSelectedItemIndex(y)}destroy(){var a,d,m;this._typeaheadSubscription.unsubscribe(),null===(a=this._itemChangesSubscription)||void 0===a||a.unsubscribe(),null===(d=this._effectRef)||void 0===d||d.destroy(),null===(m=this._typeahead)||void 0===m||m.destroy(),this.tabOut.complete(),this.change.complete()}_setActiveItemByDelta(a){this._wrap?this._setActiveInWrapMode(a):this._setActiveInDefaultMode(a)}_setActiveInWrapMode(a){const d=this._getItemsArray();for(let m=1;m<=d.length;m++){const y=(this._activeItemIndex+a*m+d.length)%d.length;if(!this._skipPredicateFn(d[y]))return void this.setActiveItem(y)}}_setActiveInDefaultMode(a){this._setActiveItemByIndex(this._activeItemIndex+a,a)}_setActiveItemByIndex(a,d){const m=this._getItemsArray();if(m[a]){for(;this._skipPredicateFn(m[a]);)if(!m[a+=d])return;this.setActiveItem(a)}}_getItemsArray(){return(0,T.Hps)(this._items)?this._items():this._items instanceof T.rOR?this._items.toArray():this._items}_itemsChanged(a){var d;if(null===(d=this._typeahead)||void 0===d||d.setItems(a),this._activeItem){const y=a.indexOf(this._activeItem);var m;y>-1&&y!==this._activeItemIndex&&(this._activeItemIndex=y,null===(m=this._typeahead)||void 0===m||m.setCurrentSelectedItemIndex(y))}}}class Ht extends $t{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(a){return this._origin=a,this}setActiveItem(a){super.setActiveItem(a),this.activeItem&&this.activeItem.focus(this._origin)}}function M(_){return 0===_.buttons||0===_.detail}function C(_){const a=_.touches&&_.touches[0]||_.changedTouches&&_.changedTouches[0];return!(!a||-1!==a.identifier||null!=a.radiusX&&1!==a.radiusX||null!=a.radiusY&&1!==a.radiusY)}var c=function(_){return _[_.NONE=0]="NONE",_[_.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",_[_.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",_}(c||{});const u="cdk-high-contrast-black-on-white",x="cdk-high-contrast-white-on-black",F="cdk-high-contrast-active";let Z=(()=>{var _;class a{constructor(m,y){this._platform=m,this._document=y,this._breakpointSubscription=(0,T.WQX)(yt).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return c.NONE;const m=this._document.createElement("div");m.style.backgroundColor="rgb(1,2,3)",m.style.position="absolute",this._document.body.appendChild(m);const y=this._document.defaultView||window,I=y&&y.getComputedStyle?y.getComputedStyle(m):null,B=(I&&I.backgroundColor||"").replace(/ /g,"");switch(m.remove(),B){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return c.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return c.BLACK_ON_WHITE}return c.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const m=this._document.body.classList;m.remove(F,u,x),this._hasCheckedHighContrastMode=!0;const y=this.getHighContrastMode();y===c.BLACK_ON_WHITE?m.add(F,u):y===c.WHITE_ON_BLACK&&m.add(F,x)}}}return(_=a).\u0275fac=function(m){return new(m||_)(T.KVO(K.OD),T.KVO(r.qQ))},_.\u0275prov=T.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),a})()},4085:(Ct,ht,k)=>{k.d(ht,{FG:()=>bt,OE:()=>K,he:()=>T,i8:()=>A});var r=k(3953);function T(O){return null!=O&&"false"!=`${O}`}function K(O,rt=0){return function W(O){return!isNaN(parseFloat(O))&&!isNaN(Number(O))}(O)?Number(O):2===arguments.length?rt:0}function bt(O){return Array.isArray(O)?O:[O]}function A(O){return O instanceof r.aKT?O.nativeElement:O}},7336:(Ct,ht,k)=>{k.d(ht,{A:()=>It,A$:()=>et,FX:()=>t,Fm:()=>bt,Ge:()=>Nt,Kp:()=>S,LE:()=>H,UQ:()=>j,W3:()=>A,Z:()=>At,bn:()=>$,dB:()=>J,eg:()=>ce,f2:()=>q,i7:()=>E,n6:()=>R,rp:()=>le,t6:()=>Q,w_:()=>at,wn:()=>K,yZ:()=>z});const K=9,bt=13,t=16,A=17,et=18,Q=32,at=33,J=34,S=35,z=36,j=37,E=38,H=39,R=40,q=48,$=57,It=65,At=90,Nt=91,ce=224;function le(ae,...se){return se.length?se.some(de=>ae[de]):ae.altKey||ae.shiftKey||ae.ctrlKey||ae.metaKey}},6860:(Ct,ht,k)=>{k.d(ht,{BQ:()=>st,Fb:()=>X,OD:()=>W,v8:()=>Y,vc:()=>R});var r=k(3953),T=k(177);let K;try{K=typeof Intl<"u"&&Intl.v8BreakIterator}catch{K=!1}let O,W=(()=>{var w;class P{constructor(tt){this._platformId=tt,this.isBrowser=this._platformId?(0,T.UE)(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!K)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return(w=P).\u0275fac=function(tt){return new(tt||w)(r.KVO(r.Agw))},w.\u0275prov=r.jDH({token:w,factory:w.\u0275fac,providedIn:"root"}),P})();function st(w){return function rt(){if(null==O&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>O=!0}))}finally{O=O||!1}return O}()?w:!!w.capture}function R(){let w=typeof document<"u"&&document?document.activeElement:null;for(;w&&w.shadowRoot;){const P=w.shadowRoot.activeElement;if(P===w)break;w=P}return w}function X(w){return w.composedPath?w.composedPath()[0]:w.target}function Y(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}},8834:(Ct,ht,k)=>{k.d(ht,{Hl:()=>lt});var r=k(3953),T=k(8820);let lt=(()=>{var ot;class mt{}return(ot=mt).\u0275fac=function(N){return new(N||ot)},ot.\u0275mod=r.$C({type:ot}),ot.\u0275inj=r.G2t({imports:[T.yE,T.pZ,T.yE]}),mt})()},8820:(Ct,ht,k)=>{k.d(ht,{$E:()=>v,yE:()=>ft,O5:()=>i,pZ:()=>h,ug:()=>Ft});var r=k(3953),T=k(5262),K=k(177);let rt=(()=>{var s;class o{}return(s=o).\u0275fac=function(u){return new(u||s)},s.\u0275mod=r.$C({type:s}),s.\u0275inj=r.G2t({}),o})();var Q=k(6860),at=k(4085);const Mt=new r.nKC("mat-sanity-checks",{providedIn:"root",factory:function yt(){return!0}});let ft=(()=>{var s;class o{constructor(u,x,F){this._sanityChecks=x,this._document=F,this._hasDoneGlobalChecks=!1,u._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(u){return!(0,Q.v8)()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[u])}}return(s=o).\u0275fac=function(u){return new(u||s)(r.KVO(T.Q_),r.KVO(Mt,8),r.KVO(K.qQ))},s.\u0275mod=r.$C({type:s}),s.\u0275inj=r.G2t({imports:[rt,rt]}),o})();var gt=function(s){return s[s.FADING_IN=0]="FADING_IN",s[s.VISIBLE=1]="VISIBLE",s[s.FADING_OUT=2]="FADING_OUT",s[s.HIDDEN=3]="HIDDEN",s}(gt||{});class Vt{constructor(o,c,u,x=!1){this._renderer=o,this.element=c,this.config=u,this._animationForciblyDisabledThroughCss=x,this.state=gt.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}}const Lt=(0,Q.BQ)({passive:!0,capture:!0});class Gt{constructor(){this._events=new Map,this._delegateEventHandler=o=>{const c=(0,Q.Fb)(o);var u;c&&(null===(u=this._events.get(o.type))||void 0===u||u.forEach((x,F)=>{(F===c||F.contains(c))&&x.forEach(Z=>Z.handleEvent(o))}))}}addHandler(o,c,u,x){const F=this._events.get(c);if(F){const Z=F.get(u);Z?Z.add(x):F.set(u,new Set([x]))}else this._events.set(c,new Map([[u,new Set([x])]])),o.runOutsideAngular(()=>{document.addEventListener(c,this._delegateEventHandler,Lt)})}removeHandler(o,c,u){const x=this._events.get(o);if(!x)return;const F=x.get(c);F&&(F.delete(u),0===F.size&&x.delete(c),0===x.size&&(this._events.delete(o),document.removeEventListener(o,this._delegateEventHandler,Lt)))}}const Pt={enterDuration:225,exitDuration:150},At=(0,Q.BQ)({passive:!0,capture:!0}),Nt=["mousedown","touchstart"],Yt=["mouseup","mouseleave","touchend","touchcancel"];class Ft{constructor(o,c,u,x){this._target=o,this._ngZone=c,this._platform=x,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,x.isBrowser&&(this._containerElement=(0,at.i8)(u))}fadeInRipple(o,c,u={}){const x=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),F={...Pt,...u.animation};u.centered&&(o=x.left+x.width/2,c=x.top+x.height/2);const Z=u.radius||function Bt(s,o,c){const u=Math.max(Math.abs(s-c.left),Math.abs(s-c.right)),x=Math.max(Math.abs(o-c.top),Math.abs(o-c.bottom));return Math.sqrt(u*u+x*x)}(o,c,x),wt=o-x.left,_=c-x.top,a=F.enterDuration,d=document.createElement("div");d.classList.add("mat-ripple-element"),d.style.left=wt-Z+"px",d.style.top=_-Z+"px",d.style.height=2*Z+"px",d.style.width=2*Z+"px",null!=u.color&&(d.style.backgroundColor=u.color),d.style.transitionDuration=`${a}ms`,this._containerElement.appendChild(d);const m=window.getComputedStyle(d),I=m.transitionDuration,B="none"===m.transitionProperty||"0s"===I||"0s, 0s"===I||0===x.width&&0===x.height,U=new Vt(this,d,u,B);d.style.transform="scale3d(1, 1, 1)",U.state=gt.FADING_IN,u.persistent||(this._mostRecentTransientRipple=U);let ct=null;return!B&&(a||F.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const Tt=()=>{ct&&(ct.fallbackTimer=null),clearTimeout(re),this._finishRippleTransition(U)},Zt=()=>this._destroyRipple(U),re=setTimeout(Zt,a+100);d.addEventListener("transitionend",Tt),d.addEventListener("transitioncancel",Zt),ct={onTransitionEnd:Tt,onTransitionCancel:Zt,fallbackTimer:re}}),this._activeRipples.set(U,ct),(B||!a)&&this._finishRippleTransition(U),U}fadeOutRipple(o){if(o.state===gt.FADING_OUT||o.state===gt.HIDDEN)return;const c=o.element,u={...Pt,...o.config.animation};c.style.transitionDuration=`${u.exitDuration}ms`,c.style.opacity="0",o.state=gt.FADING_OUT,(o._animationForciblyDisabledThroughCss||!u.exitDuration)&&this._finishRippleTransition(o)}fadeOutAll(){this._getActiveRipples().forEach(o=>o.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(o=>{o.config.persistent||o.fadeOut()})}setupTriggerEvents(o){const c=(0,at.i8)(o);!this._platform.isBrowser||!c||c===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=c,Nt.forEach(u=>{Ft._eventManager.addHandler(this._ngZone,u,c,this)}))}handleEvent(o){"mousedown"===o.type?this._onMousedown(o):"touchstart"===o.type?this._onTouchStart(o):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{Yt.forEach(c=>{this._triggerElement.addEventListener(c,this,At)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(o){o.state===gt.FADING_IN?this._startFadeOutTransition(o):o.state===gt.FADING_OUT&&this._destroyRipple(o)}_startFadeOutTransition(o){const c=o===this._mostRecentTransientRipple,{persistent:u}=o.config;o.state=gt.VISIBLE,!u&&(!c||!this._isPointerDown)&&o.fadeOut()}_destroyRipple(o){var c;const u=null!==(c=this._activeRipples.get(o))&&void 0!==c?c:null;this._activeRipples.delete(o),this._activeRipples.size||(this._containerRect=null),o===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),o.state=gt.HIDDEN,null!==u&&(o.element.removeEventListener("transitionend",u.onTransitionEnd),o.element.removeEventListener("transitioncancel",u.onTransitionCancel),null!==u.fallbackTimer&&clearTimeout(u.fallbackTimer)),o.element.remove()}_onMousedown(o){const c=(0,T._G)(o),u=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!c&&!u&&(this._isPointerDown=!0,this.fadeInRipple(o.clientX,o.clientY,this._target.rippleConfig))}_onTouchStart(o){if(!this._target.rippleDisabled&&!(0,T.w6)(o)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const c=o.changedTouches;if(c)for(let u=0;u<c.length;u++)this.fadeInRipple(c[u].clientX,c[u].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(o=>{!o.config.persistent&&(o.state===gt.VISIBLE||o.config.terminateOnPointerUp&&o.state===gt.FADING_IN)&&o.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const o=this._triggerElement;o&&(Nt.forEach(c=>Ft._eventManager.removeHandler(c,o,this)),this._pointerUpEventsRegistered&&(Yt.forEach(c=>o.removeEventListener(c,this,At)),this._pointerUpEventsRegistered=!1))}}Ft._eventManager=new Gt;const v=new r.nKC("mat-ripple-global-options");let h=(()=>{var s;class o{}return(s=o).\u0275fac=function(u){return new(u||s)},s.\u0275mod=r.$C({type:s}),s.\u0275inj=r.G2t({imports:[ft,ft]}),o})(),i=(()=>{var s;class o{}return(s=o).\u0275fac=function(u){return new(u||s)},s.\u0275mod=r.$C({type:s}),s.\u0275inj=r.G2t({imports:[ft]}),o})()},2054:(Ct,ht,k)=>{k.d(ht,{Fg:()=>oe});var r=k(3953),W=(k(4085),k(6860),k(8820));k(8359),k(6365),k(8750),k(983),k(3794),k(6648),k(1413),k(1985),k(6354),k(5964),k(9431);let E=(()=>{var p;class b{create(n){return typeof MutationObserver>"u"?null:new MutationObserver(n)}}return(p=b).\u0275fac=function(n){return new(n||p)},p.\u0275prov=r.jDH({token:p,factory:p.\u0275fac,providedIn:"root"}),b})(),X=(()=>{var p;class b{}return(p=b).\u0275fac=function(n){return new(n||p)},p.\u0275mod=r.$C({type:p}),p.\u0275inj=r.G2t({providers:[E]}),b})();var Y=k(177);let P=(()=>{var p;class b{}return(p=b).\u0275fac=function(n){return new(n||p)},p.\u0275mod=r.$C({type:p}),p.\u0275inj=r.G2t({imports:[W.yE,W.yE]}),b})();k(5262),k(4402),k(7673),k(7336),k(9417),k(6977);let oe=(()=>{var p;class b{}return(p=b).\u0275fac=function(n){return new(n||p)},p.\u0275mod=r.$C({type:p}),p.\u0275inj=r.G2t({imports:[X,Y.MD,W.yE,W.pZ,W.O5,P]}),b})()},5911:(Ct,ht,k)=>{k.d(ht,{s5:()=>et});var r=k(3953),T=k(8820);let et=(()=>{var O;class rt{}return(O=rt).\u0275fac=function(Q){return new(Q||O)},O.\u0275mod=r.$C({type:O}),O.\u0275inj=r.G2t({imports:[T.yE,T.yE]}),rt})()}}]);