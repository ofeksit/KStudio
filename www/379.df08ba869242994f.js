"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[379],{6003:(A,x,d)=>{d.d(x,{_:()=>g});var u=d(467),h=d(4412),p=d(1626),n=d(4843),s=d(3953),M=d(4796);let g=(()=>{var m;class E{constructor(l,_){this.http=l,this.authService=_,this.badgeCount=new h.t(0),this.badgeCount$=this.badgeCount.asObservable()}fetchAndSetBadgeCount(){var l=this;return(0,u.A)(function*(){let f=new p.Nl;const k=l.authService.getUserRole(),b=l.authService.getUserEmail();"team"===k&&b&&(f=f.set("trainer_email",b));try{const v=(yield(0,n._)(l.http.get("https://k-studio.co.il/wp-json/custom-api/v1/past-trainings",{params:f}))).filter(T=>!T.hasBeenSubmitted).length;l.badgeCount.next(v)}catch(P){console.error("Error fetching data for badge count",P),l.badgeCount.next(0)}})()}updateCountFromLoadedData(l){const _=l.filter(f=>!f.hasBeenSubmitted).length;this.badgeCount.next(_)}}return(m=E).\u0275fac=function(l){return new(l||m)(s.KVO(p.Qq),s.KVO(M.u))},m.\u0275prov=s.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),E})()},379:(A,x,d)=>{d.d(x,{t:()=>Z});var u=d(467),h=d(1626),p=d(4843),n=d(3953),s=d(791),M=d(4796),g=d(177);function m(i,r){if(1&i&&(n.j41(0,"div",15)(1,"h4"),n.EFF(2),n.k0s(),n.j41(3,"p"),n.EFF(4),n.nI1(5,"date"),n.nI1(6,"date"),n.k0s()()),2&i){const o=n.XpG();n.R7$(2),n.JRh(o.training.name),n.R7$(2),n.Lme("",n.i5U(5,3,o.training.start_time,"dd/MM/yyyy")," | ",n.i5U(6,6,o.training.start_time,"HH:mm"),"")}}function E(i,r){1&i&&(n.j41(0,"div",16),n.nrm(1,"ion-spinner",17),n.j41(2,"p"),n.EFF(3,"\u05d8\u05d5\u05e2\u05df \u05de\u05ea\u05d0\u05de\u05e0\u05d9\u05dd..."),n.k0s()())}function O(i,r){1&i&&(n.j41(0,"div",18),n.nrm(1,"ion-icon",19),n.j41(2,"h3"),n.EFF(3,"\u05d0\u05d9\u05df \u05de\u05ea\u05d0\u05de\u05e0\u05d9\u05dd \u05e8\u05e9\u05d5\u05de\u05d9\u05dd"),n.k0s(),n.j41(4,"p"),n.EFF(5,"\u05dc\u05d0\u05d9\u05de\u05d5\u05df \u05d6\u05d4 \u05dc\u05d0 \u05e8\u05e9\u05d5\u05de\u05d9\u05dd \u05de\u05ea\u05d0\u05de\u05e0\u05d9\u05dd."),n.k0s()())}function l(i,r){if(1&i){const o=n.RV6();n.j41(0,"ion-card",22)(1,"ion-card-header")(2,"div",23)(3,"div",24)(4,"ion-button",25),n.bIt("click",function(){const e=n.eBV(o).$implicit,a=n.XpG(2);return n.Njj(a.markStatus(e,"attended"))}),n.nrm(5,"ion-icon",26),n.k0s(),n.j41(6,"ion-button",25),n.bIt("click",function(){const e=n.eBV(o).$implicit,a=n.XpG(2);return n.Njj(a.markStatus(e,"absent"))}),n.nrm(7,"ion-icon",27),n.k0s()(),n.j41(8,"div",28)(9,"h3"),n.EFF(10),n.k0s(),n.j41(11,"p",29),n.nrm(12,"ion-icon",30),n.EFF(13),n.k0s()()()()()}if(2&i){const o=r.$implicit,t=n.XpG(2);n.R7$(4),n.Y8G("color","attended"===o.status?"success":"medium"),n.R7$(2),n.Y8G("color","absent"===o.status?"danger":"medium"),n.R7$(4),n.JRh(o.name),n.R7$(),n.BMQ("color",t.getStatusColor(o.status)),n.R7$(),n.Y8G("name",t.getStatusIcon(o.status)),n.R7$(),n.SpI(" ",t.getStatusText(o.status)," ")}}function _(i,r){if(1&i&&(n.j41(0,"ion-list",20),n.DNE(1,l,14,6,"ion-card",21),n.k0s()),2&i){const o=n.XpG();n.R7$(),n.Y8G("ngForOf",o.attendees)("ngForTrackBy",o.trackById)}}function f(i,r){1&i&&n.nrm(0,"ion-spinner",17)}function k(i,r){1&i&&(n.j41(0,"span"),n.EFF(1,"\u05e9\u05de\u05d9\u05e8\u05ea \u05e0\u05d5\u05db\u05d7\u05d5\u05ea"),n.k0s())}function b(i,r){if(1&i){const o=n.RV6();n.j41(0,"div",31)(1,"ion-button",32),n.bIt("click",function(){n.eBV(o);const e=n.XpG();return n.Njj(e.saveAttendance())}),n.DNE(2,f,1,0,"ion-spinner",33)(3,k,2,0,"span",34),n.k0s()()}if(2&i){const o=n.XpG();n.R7$(),n.Y8G("disabled",!o.hasChanges||o.isSaving),n.R7$(),n.Y8G("ngIf",o.isSaving),n.R7$(),n.Y8G("ngIf",!o.isSaving)}}let P=(()=>{var i;class r{constructor(t,e,a,c){this.modalCtrl=t,this.http=e,this.authService=a,this.toastCtrl=c,this.isLoading=!0,this.isSaving=!1,this.hasChanges=!1,this.attendees=[],this.initialStatuses=new Map,this.presentCount=0,this.absentCount=0,this.notMarkedCount=0}ngOnInit(){this.loadAttendees()}loadAttendees(){var t=this;return(0,u.A)(function*(){t.isLoading=!0;const e=`https://k-studio.co.il/wp-json/custom-api/v1/training-attendees/${t.training.id}`;try{const a=yield(0,p._)(t.http.get(e));t.attendees=a,t.attendees.forEach(c=>t.initialStatuses.set(c.id,c.status)),t.updateSummary()}catch(a){console.error("Error loading attendees",a),t.presentToast("Failed to load attendees.","danger")}finally{t.isLoading=!1}})()}markStatus(t,e){t.status=t.status===e?"not_marked":e,this.checkForChanges(),this.updateSummary()}checkForChanges(){this.hasChanges=!1;for(const t of this.attendees)if(t.status!==this.initialStatuses.get(t.id))return void(this.hasChanges=!0)}updateSummary(){this.presentCount=this.attendees.filter(t=>"attended"===t.status).length,this.absentCount=this.attendees.filter(t=>"absent"===t.status).length,this.notMarkedCount=this.attendees.filter(t=>"not_marked"===t.status).length}saveAttendance(){var t=this;return(0,u.A)(function*(){t.isSaving=!0;const a={appointmentId:t.training.id,trainerEmail:t.authService.getUserEmail(),attendance:t.attendees.filter(c=>"not_marked"!==c.status)};try{yield(0,p._)(t.http.post("https://k-studio.co.il/wp-json/custom-api/v1/save-attendance",a)),t.presentToast("\u05d4\u05e0\u05d5\u05db\u05d7\u05d5\u05ea \u05e0\u05e9\u05de\u05e8\u05d4 \u05d1\u05d4\u05e6\u05dc\u05d7\u05d4!","success"),t.modalCtrl.dismiss({saved:!0})}catch(c){console.error("Error saving attendance",c),t.presentToast("\u05e9\u05d2\u05d9\u05d0\u05d4 \u05d1\u05e9\u05de\u05d9\u05e8\u05ea \u05d4\u05e0\u05d5\u05db\u05d7\u05d5\u05ea.","danger")}finally{t.isSaving=!1}})()}getStatusText(t){switch(t){case"attended":return"\u05d4\u05d2\u05d9\u05e2\u05d4";case"absent":return"\u05dc\u05d0 \u05d4\u05d2\u05d9\u05e2\u05d4";default:return"\u05dc\u05d0 \u05e1\u05d5\u05de\u05df"}}getStatusColor(t){switch(t){case"attended":return"success";case"absent":return"danger";default:return"medium"}}getStatusIcon(t){switch(t){case"attended":return"checkmark-circle-outline";case"absent":return"close-circle-outline";default:return"ellipse-outline"}}trackById(t,e){return e.id}presentToast(t,e){var a=this;return(0,u.A)(function*(){(yield a.toastCtrl.create({message:t,duration:3e3,color:e,position:"bottom"})).present()})()}closeModal(){this.modalCtrl.dismiss({saved:!1})}}return(i=r).\u0275fac=function(t){return new(t||i)(n.rXU(s.W3),n.rXU(h.Qq),n.rXU(M.u),n.rXU(s.K_))},i.\u0275cmp=n.VBU({type:i,selectors:[["app-attendance-marker"]],inputs:{training:"training"},decls:25,vars:8,consts:[[1,"popup-modal"],[1,"drag-handle"],[1,"page-content-wrapper"],[1,"sticky-header"],[1,"header-title"],["class","training-info",4,"ngIf"],[1,"attendance-summary"],[1,"summary-item"],["name","checkmark-circle-outline","color","success"],["name","close-circle-outline","color","danger"],["name","help-circle-outline","color","medium"],["class","loading-container",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","customers-list","lines","none",4,"ngIf"],["class","save-button-container",4,"ngIf"],[1,"training-info"],[1,"loading-container"],["name","crescent"],[1,"empty-state"],["name","people-outline","size","large"],["lines","none",1,"customers-list"],["class","customer-card",4,"ngFor","ngForOf","ngForTrackBy"],[1,"customer-card"],[1,"customer-info"],[1,"status-buttons"],["fill","clear",3,"click","color"],["slot","icon-only","name","checkmark-outline"],["slot","icon-only","name","close-outline"],[1,"customer-details"],[1,"status-text"],[3,"name"],[1,"save-button-container"],["expand","block",3,"click","disabled"],["name","crescent",4,"ngIf"],[4,"ngIf"]],template:function(t,e){1&t&&(n.j41(0,"ion-content",0),n.nrm(1,"div",1),n.j41(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3"),n.EFF(6,"\u05e1\u05d9\u05de\u05d5\u05df \u05e0\u05d5\u05db\u05d7\u05d5\u05ea"),n.k0s()(),n.DNE(7,m,7,9,"div",5),n.j41(8,"div",6)(9,"div",7),n.nrm(10,"ion-icon",8),n.j41(11,"span"),n.EFF(12),n.k0s()(),n.j41(13,"div",7),n.nrm(14,"ion-icon",9),n.j41(15,"span"),n.EFF(16),n.k0s()(),n.j41(17,"div",7),n.nrm(18,"ion-icon",10),n.j41(19,"span"),n.EFF(20),n.k0s()()()(),n.DNE(21,E,4,0,"div",11)(22,O,6,0,"div",12)(23,_,2,2,"ion-list",13)(24,b,4,3,"div",14),n.k0s()()),2&t&&(n.R7$(7),n.Y8G("ngIf",e.training),n.R7$(5),n.SpI("\u05e0\u05d5\u05db\u05d7\u05d9\u05dd: ",e.presentCount,""),n.R7$(4),n.SpI("\u05e0\u05e2\u05d3\u05e8\u05d5: ",e.absentCount,""),n.R7$(4),n.SpI("\u05dc\u05d0 \u05e1\u05d5\u05de\u05df: ",e.notMarkedCount,""),n.R7$(),n.Y8G("ngIf",e.isLoading),n.R7$(),n.Y8G("ngIf",!e.isLoading&&0===e.attendees.length),n.R7$(),n.Y8G("ngIf",!e.isLoading&&e.attendees.length>0),n.R7$(),n.Y8G("ngIf",!e.isLoading&&e.attendees.length>0))},dependencies:[g.Sq,g.bT,s.Jm,s.b_,s.ME,s.W9,s.iq,s.nf,s.w2,g.vh],styles:["[_nghost-%COMP%]   ion-content.popup-modal[_ngcontent-%COMP%]{--background: #f4f5f8}.drag-handle[_ngcontent-%COMP%]{width:40px;height:5px;background-color:transparent;border-radius:2.5px;margin:0 auto 15px}.page-content-wrapper[_ngcontent-%COMP%]{padding:0 16px}.sticky-header[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;background-color:#f4f5f8;padding-top:5px;padding-bottom:15px;border-bottom:1px solid #e9e9e9}.header-title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 5px 10px}.header-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:600;font-size:1.2rem}.header-title[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 5px;--padding-end: 5px}.training-info[_ngcontent-%COMP%]{text-align:center;margin-bottom:15px}.training-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 5px;font-weight:600;font-size:1.1rem;color:#333}.training-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666;font-size:.9rem}.attendance-summary[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:20px;padding:10px 0}.attendance-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px}.attendance-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem}.attendance-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;font-size:.9rem}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:15px;color:#666;font-size:.9rem}.customers-list[_ngcontent-%COMP%]{padding:15px 0}.customer-card[_ngcontent-%COMP%]{margin:10px 0;border-radius:12px;box-shadow:0 2px 8px #00000012}.customer-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding:16px}.customer-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.customer-details[_ngcontent-%COMP%]{text-align:right;flex:1}.customer-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 5px;font-size:1rem;font-weight:600;color:#333}.customer-details[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{margin:0;font-size:.85rem;display:flex;align-items:center;justify-content:flex-end;gap:5px}.customer-details[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem}.status-buttons[_ngcontent-%COMP%]{display:flex;gap:5px}.status-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px;--min-width: 40px;--min-height: 40px}.status-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.3rem}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#888}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-bottom:15px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600;margin:0 0 10px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;margin:0}.save-button-container[_ngcontent-%COMP%]{position:sticky;bottom:0;background:var(--ion-background-color, #f4f5f8);padding:15px 0;border-top:1px solid #e9e9e9}.save-button-container[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px;--padding-top: 12px;--padding-bottom: 12px;font-weight:600}.status-text[color=success][_ngcontent-%COMP%]{color:var(--ion-color-success)}.status-text[color=danger][_ngcontent-%COMP%]{color:var(--ion-color-danger)}.status-text[color=medium][_ngcontent-%COMP%]{color:var(--ion-color-medium)}.status-text[color=warning][_ngcontent-%COMP%]{color:var(--ion-color-warning)}"]}),r})();var v=d(9417);function T(i,r){if(1&i&&(n.j41(0,"div",11)(1,"h4"),n.EFF(2),n.k0s(),n.j41(3,"p"),n.EFF(4),n.nI1(5,"date"),n.nI1(6,"date"),n.k0s()()),2&i){const o=n.XpG();n.R7$(2),n.JRh(o.training.training_name),n.R7$(2),n.Lme("",n.i5U(5,3,o.training.start_time,"dd/MM/yyyy")," \u2022 ",n.i5U(6,6,o.training.start_time,"HH:mm"),"")}}function j(i,r){1&i&&(n.j41(0,"div",12),n.nrm(1,"ion-spinner",13),n.j41(2,"p"),n.EFF(3,"\u05d8\u05d5\u05e2\u05df \u05de\u05d0\u05de\u05e0\u05d9\u05dd..."),n.k0s()())}function I(i,r){if(1&i&&(n.j41(0,"ion-item",18),n.nrm(1,"ion-radio",19),n.j41(2,"ion-label")(3,"h3"),n.EFF(4),n.k0s(),n.j41(5,"p"),n.EFF(6),n.k0s()()()),2&i){const o=r.$implicit,t=n.XpG(2);n.BMQ("aria-checked",t.selectedTrainerEmail===o.email),n.R7$(),n.Y8G("value",o.email),n.BMQ("aria-label","\u05d1\u05d7\u05e8 \u05de\u05d0\u05de\u05df "+o.name),n.R7$(3),n.JRh(o.name),n.R7$(2),n.JRh(o.email)}}function R(i,r){if(1&i){const o=n.RV6();n.j41(0,"ion-list",14)(1,"ion-list-header",15)(2,"ion-label"),n.EFF(3,"\u05d1\u05d7\u05e8/\u05d9 \u05de\u05d0\u05de\u05df \u05de\u05d4\u05e8\u05e9\u05d9\u05de\u05d4"),n.k0s()(),n.j41(4,"ion-radio-group",16),n.mxI("ngModelChange",function(e){n.eBV(o);const a=n.XpG();return n.DH7(a.selectedTrainerEmail,e)||(a.selectedTrainerEmail=e),n.Njj(e)}),n.DNE(5,I,7,5,"ion-item",17),n.k0s()()}if(2&i){const o=n.XpG();n.R7$(4),n.R50("ngModel",o.selectedTrainerEmail),n.R7$(),n.Y8G("ngForOf",o.teamMembers)("ngForTrackBy",o.trackByEmail)}}function $(i,r){1&i&&(n.j41(0,"div",20)(1,"p"),n.EFF(2,"\u05dc\u05d0 \u05e0\u05de\u05e6\u05d0\u05d5 \u05de\u05d0\u05de\u05e0\u05d9\u05dd \u05d6\u05de\u05d9\u05e0\u05d9\u05dd"),n.k0s()())}function S(i,r){1&i&&n.nrm(0,"ion-spinner",21)}function G(i,r){1&i&&(n.j41(0,"span"),n.EFF(1,"\u05e9\u05de\u05d5\u05e8 \u05e9\u05d9\u05d1\u05d5\u05e5"),n.k0s())}let w=(()=>{var i;class r{constructor(t,e,a){this.modalCtrl=t,this.http=e,this.toastCtrl=a,this.teamMembers=[],this.selectedTrainerEmail="",this.isLoading=!0,this.isSaving=!1}ngOnInit(){this.loadTeamMembers()}loadTeamMembers(){var t=this;return(0,u.A)(function*(){t.isLoading=!0;try{const a=yield(0,p._)(t.http.get("https://k-studio.co.il/wp-json/custom-api/v1/team-members"));t.teamMembers=a.map(c=>({email:c.email,name:c.name})),console.log("Team members loaded:",t.teamMembers)}catch(a){console.error("Error loading team members",a),t.presentToast("Failed to load trainers.","danger")}finally{t.isLoading=!1}})()}trackByEmail(t,e){return e.email}saveAssignment(){var t=this;return(0,u.A)(function*(){if(!t.selectedTrainerEmail)return void t.presentToast("Please select a trainer.","warning");t.isSaving=!0;const a={appointmentId:t.training.id,trainerEmail:t.selectedTrainerEmail};try{yield(0,p._)(t.http.post("https://k-studio.co.il/wp-json/custom-api/v1/assign-trainer",a)),t.presentToast("Trainer assigned successfully!","success"),t.modalCtrl.dismiss({assigned:!0})}catch(c){console.error("Error assigning trainer",c),t.presentToast("Error assigning trainer.","danger")}finally{t.isSaving=!1}})()}presentToast(t,e){var a=this;return(0,u.A)(function*(){(yield a.toastCtrl.create({message:t,duration:3e3,color:e,position:"top"})).present()})()}closeModal(){this.modalCtrl.dismiss()}}return(i=r).\u0275fac=function(t){return new(t||i)(n.rXU(s.W3),n.rXU(h.Qq),n.rXU(s.K_))},i.\u0275cmp=n.VBU({type:i,selectors:[["app-assign-trainer-modal"]],inputs:{training:"training"},decls:16,vars:8,consts:[["slot","start"],["fill","clear","aria-label","\u05e1\u05d2\u05d5\u05e8 \u05d7\u05dc\u05d5\u05df",3,"click"],["slot","icon-only","name","close-outline"],["role","main",1,"ion-padding-horizontal"],["class","training-info",4,"ngIf"],["class","ion-text-center ion-padding","role","status","aria-live","polite",4,"ngIf"],["role","radiogroup","aria-labelledby","trainer-list-header",4,"ngIf"],["class","ion-text-center ion-padding","role","alert",4,"ngIf"],["expand","block",3,"click","disabled"],["name","crescent","aria-hidden","true",4,"ngIf"],[4,"ngIf"],[1,"training-info"],["role","status","aria-live","polite",1,"ion-text-center","ion-padding"],["name","crescent"],["role","radiogroup","aria-labelledby","trainer-list-header"],["id","trainer-list-header"],[3,"ngModelChange","ngModel"],["role","radio","button","true",4,"ngFor","ngForOf","ngForTrackBy"],["role","radio","button","true"],["slot","start",3,"value"],["role","alert",1,"ion-text-center","ion-padding"],["name","crescent","aria-hidden","true"]],template:function(t,e){1&t&&(n.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),n.bIt("click",function(){return e.closeModal()}),n.nrm(4,"ion-icon",2),n.k0s()(),n.j41(5,"ion-title"),n.EFF(6,"\u05e9\u05d9\u05d1\u05d5\u05e5 \u05de\u05d0\u05de\u05df"),n.k0s()()(),n.j41(7,"ion-content",3),n.DNE(8,T,7,9,"div",4)(9,j,4,0,"div",5)(10,R,6,3,"ion-list",6)(11,$,3,0,"div",7),n.k0s(),n.j41(12,"ion-footer")(13,"ion-button",8),n.bIt("click",function(){return e.saveAssignment()}),n.DNE(14,S,1,0,"ion-spinner",9)(15,G,2,0,"span",10),n.k0s()()),2&t&&(n.R7$(8),n.Y8G("ngIf",e.training),n.R7$(),n.Y8G("ngIf",e.isLoading),n.R7$(),n.Y8G("ngIf",!e.isLoading&&e.teamMembers.length>0),n.R7$(),n.Y8G("ngIf",!e.isLoading&&0===e.teamMembers.length),n.R7$(2),n.Y8G("disabled",e.isSaving||!e.selectedTrainerEmail),n.BMQ("aria-label",e.isSaving?"\u05e9\u05d5\u05de\u05e8 \u05e9\u05d9\u05d1\u05d5\u05e5...":"\u05e9\u05de\u05d5\u05e8 \u05e9\u05d9\u05d1\u05d5\u05e5 \u05de\u05d0\u05de\u05df"),n.R7$(),n.Y8G("ngIf",e.isSaving),n.R7$(),n.Y8G("ngIf",!e.isSaving))},dependencies:[g.Sq,g.bT,v.BC,v.vS,s.Jm,s.QW,s.W9,s.M0,s.eU,s.iq,s.uz,s.he,s.nf,s.AF,s.KO,s.f0,s.w2,s.BC,s.ai,s.Je,g.vh],styles:["ion-content[_ngcontent-%COMP%]{--background: #f8f9fa}.training-info[_ngcontent-%COMP%]{text-align:center;margin:20px 16px;padding:16px;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000000d}.training-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 8px;font-weight:600;color:#2c3e50;font-size:1.1rem}.training-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#7f8c8d;font-size:.9rem}ion-list[_ngcontent-%COMP%]{background:transparent;margin:0 16px}ion-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]{--background: transparent;--color: #34495e;font-weight:600;padding-left:0;margin-bottom:8px}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: white;--border-radius: 8px;--padding-start: 16px;--padding-end: 16px;margin-bottom:8px;box-shadow:0 2px 4px #0000000d}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-radio[_ngcontent-%COMP%]{--color: #bdc3c7;--color-checked: var(--ion-color-primary)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:.95rem;color:#2c3e50}ion-footer[_ngcontent-%COMP%]{background:#fff;padding:16px;box-shadow:0 -2px 8px #0000000d}ion-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-weight:600;text-transform:none}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: white;--border-width: 0;box-shadow:0 2px 12px #00000014}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;color:#2c3e50}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--color: #7f8c8d}ion-list[_ngcontent-%COMP%]{background:#f8f9fa;border:2px dashed red;padding:16px}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: white;margin-bottom:8px;border:1px solid #ddd;border-radius:8px}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;font-weight:500}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;font-size:.8rem}"]}),r})();var B=d(6003);const y=()=>[1,2,3,4,5];function U(i,r){if(1&i){const o=n.RV6();n.j41(0,"ion-segment",10),n.bIt("ionChange",function(e){n.eBV(o);const a=n.XpG();return n.Njj(a.segmentChanged(e))}),n.j41(1,"ion-segment-button",11)(2,"ion-label"),n.EFF(3,"\u05d0\u05d9\u05de\u05d5\u05e0\u05d9 \u05e2\u05d1\u05e8"),n.k0s()(),n.j41(4,"ion-segment-button",12)(5,"ion-label"),n.EFF(6,"\u05e9\u05d9\u05d1\u05d5\u05e5 \u05de\u05d0\u05de\u05e0\u05d9\u05dd"),n.k0s()()()}if(2&i){const o=n.XpG();n.Y8G("value",o.currentSegment)}}function L(i,r){1&i&&n.nrm(0,"ion-card",15)}function Y(i,r){1&i&&(n.j41(0,"ion-list",13),n.DNE(1,L,1,0,"ion-card",14),n.k0s()),2&i&&(n.R7$(),n.Y8G("ngForOf",n.lJ4(1,y)))}function X(i,r){if(1&i){const o=n.RV6();n.j41(0,"ion-card",21),n.bIt("click",function(){const e=n.eBV(o).$implicit,a=n.XpG(2);return n.Njj(a.openAttendanceMarker(e))}),n.j41(1,"ion-card-header")(2,"div",22),n.nrm(3,"ion-icon",23),n.k0s(),n.j41(4,"ion-label",24)(5,"h2"),n.EFF(6),n.k0s(),n.j41(7,"p"),n.EFF(8),n.nI1(9,"date"),n.nI1(10,"date"),n.k0s()()()()}if(2&i){const o=r.$implicit;n.R7$(3),n.Y8G("name",o.hasBeenSubmitted?"checkmark-done-circle":"ellipse-outline")("color",o.hasBeenSubmitted?"success":"medium"),n.R7$(3),n.JRh(o.training_name),n.R7$(2),n.Lme("",n.i5U(9,5,o.start_time,"dd/MM/yyyy")," | ",n.i5U(10,8,o.start_time,"HH:mm"),"")}}function z(i,r){1&i&&(n.j41(0,"div",25)(1,"h3"),n.EFF(2,"\u05d0\u05d9\u05df \u05d0\u05d9\u05de\u05d5\u05e0\u05d9 \u05e2\u05d1\u05e8 \u05dc\u05d4\u05e6\u05d2\u05d4"),n.k0s()())}function N(i,r){if(1&i){const o=n.RV6();n.j41(0,"div",16),n.DNE(1,X,11,11,"ion-card",17),n.j41(2,"ion-infinite-scroll",18),n.bIt("ionInfinite",function(e){n.eBV(o);const a=n.XpG();return n.Njj(a.loadMorePastTrainings(e))}),n.nrm(3,"ion-infinite-scroll-content",19),n.k0s(),n.DNE(4,z,3,0,"div",20),n.k0s()}if(2&i){const o=n.XpG();n.R7$(),n.Y8G("ngForOf",o.pastTrainings),n.R7$(),n.Y8G("disabled",o.allPastTrainingsLoaded),n.R7$(2),n.Y8G("ngIf",!o.isLoading&&0===o.pastTrainings.length)}}function V(i,r){1&i&&n.nrm(0,"ion-card",15)}function J(i,r){1&i&&(n.j41(0,"ion-list",13),n.DNE(1,V,1,0,"ion-card",14),n.k0s()),2&i&&(n.R7$(),n.Y8G("ngForOf",n.lJ4(1,y)))}function W(i,r){if(1&i&&(n.j41(0,"div",31),n.nrm(1,"ion-icon",32),n.j41(2,"span"),n.EFF(3),n.k0s()()),2&i){const o=n.XpG().$implicit;n.R7$(3),n.SpI("\u05de\u05e9\u05d5\u05d1\u05e5: ",o.assigned_trainer_name,"")}}function H(i,r){if(1&i){const o=n.RV6();n.j41(0,"ion-card",27)(1,"ion-card-header")(2,"ion-label",24)(3,"h2"),n.EFF(4),n.k0s(),n.j41(5,"p"),n.EFF(6),n.nI1(7,"date"),n.nI1(8,"date"),n.k0s(),n.DNE(9,W,4,1,"div",28),n.k0s(),n.j41(10,"ion-button",29),n.bIt("click",function(){const e=n.eBV(o).$implicit,a=n.XpG(2);return n.Njj(a.openTrainerAssignmentModal(e))}),n.nrm(11,"ion-icon",30),n.EFF(12),n.k0s()()()}if(2&i){const o=r.$implicit;n.R7$(4),n.JRh(o.training_name),n.R7$(2),n.Lme("",n.i5U(7,6,o.start_time,"dd/MM/yyyy")," | ",n.i5U(8,9,o.start_time,"HH:mm")," "),n.R7$(3),n.Y8G("ngIf",o.assigned_trainer_name),n.R7$(2),n.Y8G("name",o.assigned_trainer_name?"swap-horizontal-outline":"person-add-outline"),n.R7$(),n.SpI(" ",o.assigned_trainer_name?"\u05e9\u05e0\u05d4 \u05e9\u05d9\u05d1\u05d5\u05e5":"\u05e9\u05d1\u05e5 \u05de\u05d0\u05de\u05df"," ")}}function K(i,r){1&i&&(n.j41(0,"div",25)(1,"h3"),n.EFF(2,"\u05d0\u05d9\u05df \u05d0\u05d9\u05de\u05d5\u05e0\u05d9\u05dd \u05d4\u05de\u05de\u05ea\u05d9\u05e0\u05d9\u05dd \u05dc\u05e9\u05d9\u05d1\u05d5\u05e5"),n.k0s()())}function Q(i,r){if(1&i&&(n.j41(0,"div"),n.DNE(1,H,13,12,"ion-card",26)(2,K,3,0,"div",20),n.k0s()),2&i){const o=n.XpG();n.R7$(),n.Y8G("ngForOf",o.upcomingTrainings),n.R7$(),n.Y8G("ngIf",!o.isLoadingUpcoming&&0===o.upcomingTrainings.length)}}let Z=(()=>{var i;class r{constructor(t,e,a,c){this.http=t,this.modalCtrl=e,this.authService=a,this.attendanceBadgeService=c,this.isLoading=!0,this.pastTrainings=[],this.userRole="",this.currentSegment="past",this.isLoadingUpcoming=!0,this.upcomingTrainings=[],this.pastTrainingsPage=1,this.allPastTrainingsLoaded=!1,this.userRole=this.authService.getUserRole()}ngOnInit(){this.loadInitialData(),console.log("pastTrainings:",this.pastTrainings)}openTrainerAssignmentModal(t){var e=this;return(0,u.A)(function*(){const a=yield e.modalCtrl.create({component:w,componentProps:{training:t},cssClass:"centered-assign-modal"});yield a.present();const{data:c}=yield a.onDidDismiss();null!=c&&c.assigned&&e.loadUpcomingTrainingsForAssignment()})()}loadUpcomingTrainingsForAssignment(){var t=this;return(0,u.A)(function*(){t.isLoadingUpcoming=!0;try{const a=yield(0,p._)(t.http.get("https://k-studio.co.il/wp-json/custom-api/v1/upcoming-for-assignment"));console.log("API Response for Upcoming Trainings:",a),t.upcomingTrainings=a}catch(a){console.error("Error loading upcoming trainings for assignment",a)}finally{t.isLoadingUpcoming=!1}})()}segmentChanged(t){this.currentSegment=t.detail.value}loadTrainings(t){var e=this;return(0,u.A)(function*(){1===e.pastTrainingsPage&&(e.isLoading=!0);let c=(new h.Nl).set("page",e.pastTrainingsPage.toString());const D=e.authService.getUserEmail();"team"===e.userRole&&D&&(c=c.set("trainer_email",D));try{const C=yield(0,p._)(e.http.get("https://k-studio.co.il/wp-json/custom-api/v1/past-trainings",{params:c}));e.pastTrainings.push(...C),e.attendanceBadgeService.updateCountFromLoadedData(e.pastTrainings),C.length<15&&(e.allPastTrainingsLoaded=!0),null==t||t.target.complete()}catch(C){console.error("Error loading past trainings",C)}finally{e.isLoading=!1}})()}loadMorePastTrainings(t){this.pastTrainingsPage++,this.loadTrainings(t)}loadInitialData(){this.pastTrainings=[],this.pastTrainingsPage=1,this.allPastTrainingsLoaded=!1,this.loadTrainings(),"administrator"===this.userRole&&this.loadUpcomingTrainingsForAssignment()}openAttendanceMarker(t){var e=this;return(0,u.A)(function*(){const a=yield e.modalCtrl.create({component:P,componentProps:{training:{id:t.id,name:t.training_name,start_time:t.start_time}},cssClass:"attendance-marker-modal",breakpoints:[0,.8],initialBreakpoint:.8});yield a.present();const{data:c}=yield a.onDidDismiss();if(null!=c&&c.saved)try{const D=`https://k-studio.co.il/wp-json/custom-api/v1/past-training/${t.id}`,C=yield(0,p._)(e.http.get(D)),F=e.pastTrainings.findIndex(q=>q.id===t.id);-1!==F&&(e.pastTrainings[F]=C,e.attendanceBadgeService.updateCountFromLoadedData(e.pastTrainings))}catch(D){console.error("Failed to refresh training data, reloading list as a fallback.",D),e.loadInitialData()}})()}closeModal(){this.modalCtrl.dismiss()}}return(i=r).\u0275fac=function(t){return new(t||i)(n.rXU(h.Qq),n.rXU(s.W3),n.rXU(M.u),n.rXU(B._))},i.\u0275cmp=n.VBU({type:i,selectors:[["app-attendance-dashboard"]],decls:14,vars:7,consts:[[1,"popup-modal"],[1,"drag-handle"],[1,"page-content-wrapper"],[1,"sticky-header"],[1,"header-title"],[3,"value","ionChange",4,"ngIf"],[3,"hidden"],["lines","none","class","skeleton-list",4,"ngIf"],["class","scrollable-list",4,"ngIf"],[4,"ngIf"],[3,"ionChange","value"],["value","past"],["value","upcoming"],["lines","none",1,"skeleton-list"],["class","skeleton-card",4,"ngFor","ngForOf"],[1,"skeleton-card"],[1,"scrollable-list"],["class","clickable",3,"click",4,"ngFor","ngForOf"],[3,"ionInfinite","disabled"],["loadingSpinner","crescent"],["class","empty-state",4,"ngIf"],[1,"clickable",3,"click"],[1,"icon-container"],[3,"name","color"],[1,"training-details"],[1,"empty-state"],["class","assignment-card",4,"ngFor","ngForOf"],[1,"assignment-card"],["class","assigned-trainer",4,"ngIf"],["fill","outline",1,"assign-button",3,"click"],["slot","start",3,"name"],[1,"assigned-trainer"],["name","person-circle","color","success"]],template:function(t,e){1&t&&(n.j41(0,"ion-content",0),n.nrm(1,"div",1),n.j41(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3"),n.EFF(6,"\u05e0\u05d9\u05d4\u05d5\u05dc \u05e0\u05d5\u05db\u05d7\u05d5\u05ea \u05d5\u05e9\u05d9\u05d1\u05d5\u05e6\u05d9\u05dd"),n.k0s()(),n.DNE(7,U,7,1,"ion-segment",5),n.k0s(),n.j41(8,"div",6),n.DNE(9,Y,2,2,"ion-list",7)(10,N,5,3,"div",8),n.k0s(),n.j41(11,"div",6),n.DNE(12,J,2,2,"ion-list",7)(13,Q,3,2,"div",9),n.k0s()()()),2&t&&(n.R7$(7),n.Y8G("ngIf","administrator"===e.userRole),n.R7$(),n.Y8G("hidden","past"!==e.currentSegment),n.R7$(),n.Y8G("ngIf",e.isLoading),n.R7$(),n.Y8G("ngIf",!e.isLoading),n.R7$(),n.Y8G("hidden","upcoming"!==e.currentSegment),n.R7$(),n.Y8G("ngIf",e.isLoadingUpcoming),n.R7$(),n.Y8G("ngIf",!e.isLoadingUpcoming))},dependencies:[g.Sq,g.bT,s.Jm,s.b_,s.ME,s.W9,s.iq,s.Ax,s.Hp,s.he,s.nf,s.Gp,s.eP,s.Je,g.vh],styles:[".popup-modal[_ngcontent-%COMP%]{height:80vh;border-top-left-radius:20px;border-top-right-radius:20px;background:#fff;padding:10px;box-shadow:0 -4px 12px #0000001a;overflow-y:auto;max-height:100vh}.drag-handle[_ngcontent-%COMP%]{width:40px;height:5px;background-color:transparent;border-radius:2.5px;margin:0 auto 15px}.page-content-wrapper[_ngcontent-%COMP%]{padding:0 16px}.sticky-header[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;background:#fff;padding:10px 0;border-bottom:1px solid #e0e0e0}.header-title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 5px 10px}.header-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:600;font-size:1.2rem;text-align:center}.header-title[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 5px;--padding-end: 5px}ion-segment[_ngcontent-%COMP%]{--background: #e9e9e9;border-radius:8px}ion-segment-button[_ngcontent-%COMP%]{--color: #777;--color-checked: #fff;--indicator-color: var(--ion-color-primary, #3880ff);font-weight:500}ion-card[_ngcontent-%COMP%]{margin:12px 0;border-radius:12px;box-shadow:0 2px 8px #00000012}ion-card.clickable[_ngcontent-%COMP%]{cursor:pointer}ion-card.disabled[_ngcontent-%COMP%]{opacity:.6}ion-card-header[_ngcontent-%COMP%]{display:flex;flex-direction:row-reverse;align-items:center;padding:16px}.icon-container[_ngcontent-%COMP%]{margin-right:16px}.icon-container[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:2rem}.training-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-align:right;width:100%}.training-details[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#333;margin:0}.training-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem;color:#666;margin:4px 0 0}.empty-state[_ngcontent-%COMP%]{text-align:center;margin-top:40px;color:#888}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}.skeleton-list[_ngcontent-%COMP%]{padding-top:10px}.skeleton-card[_ngcontent-%COMP%]{margin:12px 0}ion-segment[_ngcontent-%COMP%]{margin-top:10px;--background: #e9e9e9;border-radius:8px;height:40px}ion-segment-button[_ngcontent-%COMP%]{--color: #666;--color-checked: #fff;--indicator-color: var(--ion-color-primary, #3880ff);font-weight:500}.assignment-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{justify-content:space-between}.assignment-card[_ngcontent-%COMP%]   .assign-button[_ngcontent-%COMP%]{--border-radius: 8px;margin-left:10px}.assigned-trainer[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;margin-top:8px;font-size:.85rem;color:var(--ion-color-success-shade)}.assigned-trainer[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.1rem}.assigned-trainer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500}"]}),r})()}}]);